
  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_ALIMENTADORES" ("PRI_ALIMENTADOR_ID", "CD_ALIMENTADOR", "NR_LOCALINST_SAP")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT PRI.PRI_ALIMENTADOR_ID, SAP.CD_ALIMENTADOR, SAP.NR_LOCALINST_SAP  
  FROM gen_bdgd2019.VS_PRI_ALIMENTADOR PRI 
  LEFT JOIN gen_bdgd2019.TAB_SAP_ALIMENTADOR SAP ON PRI.NR_LOCALINST_GEN = SAP.NR_LOCALINST_GEN
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_ALI_CTMT" ("ID", "CD_ALIMENTADOR", "NR_LOCALINST_SAP", "NR_PTO_ELET_FIM", "FILHO_ALIMENTADOR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select ali.id,
       --ali.PRI_ALIMENTADOR_ID,
       ali.CD_ALIMENTADOR,
       sap.nr_localinst_sap,
       rde.nr_pto_elet_fim,
       rde_2.nr_pto_elet_fim filho_alimentador
       --(select * from rde_conec_cpr where )
from gen_bdgd2019.vs_pri_alimentador ali
     left join gen_bdgd2019.rde_conec_cpr rde
          on ali.id = rde.feature_id
     left join gen_bdgd2019.rde_conec_cpr rde_2
          on rde_2.nr_pto_elet_inicio = rde.nr_pto_elet_fim
     left join gen_bdgd2019.tab_sap_alimentador sap
          on sap.cd_alimentador = ali.CD_ALIMENTADOR
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_AUD_REDE_BT" ("FEATURE_ID", "FEATURE_TYPE", "PAC_PAI", "LEVEL", "ID_TRANSFORMADOR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM gen_bdgd2019.TAB_AUD_REDE_BT
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_AUD_REDE_MT" ("FEATURE_ID", "FEATURE_TYPE", "PAC_PAI", "LEVEL", "PRI_ALIMENTADOR_ID")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM gen_bdgd2019.TAB_AUD_REDE_MT
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_AUX_ALI_CTMT" ("ID", "CD_ALIMENTADOR", "NR_LOCALINST_SAP", "NR_PTO_ELET_FIM", "FILHO_ALIMENTADOR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select ali.id,
       --ali.PRI_ALIMENTADOR_ID,
       ali.CD_ALIMENTADOR,
       sap.nr_localinst_sap,
       rde.nr_pto_elet_fim,
       rde_2.nr_pto_elet_fim filho_alimentador
       --(select * from rde_conec_cpr where )
from vs_pri_alimentador ali
     left join rde_conec_cpr rde
          on ali.id = rde.feature_id
     left join rde_conec_cpr rde_2
          on rde_2.nr_pto_elet_inicio = rde.nr_pto_elet_fim
     left join tab_sap_alimentador sap
          on sap.cd_alimentador = ali.CD_ALIMENTADOR
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_CABOS_GEN_MT_BT" ("ID", "OLD_ID_CABO_DISTR", "RS_SEQ_POSIT_CABDT", "RS_SEQ_ZERO_CABDT", "RX_SEQ_POSIT_CABDT", "RX_SEQ_ZERO_CABDT", "RX_CAPTV_CABDT", "CR_NOMINAL_CABDT", "FO_TRACAO_RPT_CBDT", "PS_CABO_DISTR", "ID_UND_BITOLA_CBDT", "ID_CONDC_USO1_CBDT", "ID_CONDC_USO2_CBDT", "CD_CABO_DISTR", "RS_CIRC_SECDR_CBDT", "RX_CIRC_SECDR_CBDT", "DS_OBS_CABDT", "CD_ESTRT_SUPRT_RD", "ID_INST_LADO_POSTE", "ID_TIPO_BEM", "ID_TIPO_MATERIAL", "ID_TIPO_ISOLAMENTO", "ID_BITOLA", "ID_NUM_FASES", "ID_FORMACAO_CABDT", "CR_MAX_CABDT", "FATOR_CONVERSAO", "ID_MULTPL_FASE_CONTAB", "TIPO_CABO_DIST_ID", "BIT_ID", "BIT_DESC", "FOR_ID", "FOR_DESC", "MAT_ID", "MAT_DESC", "ISO_ID", "CAB_ISO_DESC")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT "ID",
        "OLD_ID_CABO_DISTR",
        "RS_SEQ_POSIT_CABDT",
        "RS_SEQ_ZERO_CABDT",
        "RX_SEQ_POSIT_CABDT",
        "RX_SEQ_ZERO_CABDT",
        "RX_CAPTV_CABDT",
        "CR_NOMINAL_CABDT",
        "FO_TRACAO_RPT_CBDT",
        "PS_CABO_DISTR",
        "ID_UND_BITOLA_CBDT",
        "ID_CONDC_USO1_CBDT",
        "ID_CONDC_USO2_CBDT",
        "CD_CABO_DISTR",
        "RS_CIRC_SECDR_CBDT",
        "RX_CIRC_SECDR_CBDT",
        "DS_OBS_CABDT",
        "CD_ESTRT_SUPRT_RD",
        "ID_INST_LADO_POSTE",
        "ID_TIPO_BEM",
        "ID_TIPO_MATERIAL",
        "ID_TIPO_ISOLAMENTO",
        "ID_BITOLA",
        "ID_NUM_FASES",
        "ID_FORMACAO_CABDT",
        "CR_MAX_CABDT",
        "FATOR_CONVERSAO",
        "ID_MULTPL_FASE_CONTAB",
        "TIPO_CABO_DIST_ID",
        "BIT_ID",
        "BIT_DESC",
        "FOR_ID",
        "FOR_DESC",
        "MAT_ID",
        "MAT_DESC",
        "ISO_ID",
        "CAB_ISO_DESC"
FROM gen_bdgd2019.TIPO_CABO_DIST CABO_GEN FULL
JOIN gen_bdgd2019.CAD_BDGD_CABOS_MT_BT CABO_BDGD
    ON CABO_GEN.ID = CABO_BDGD.TIPO_CABO_DIST_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_CONECTIVIDADE_SE_AT" ("ID", "PAC", "LOC_INST_SAP")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select ltr.id,
       'SE-'||node.objectid pac,
       node.loc_inst_sap
from tab_node_sub node
     inner join gen_bdgd2019.vs_pri_estrutura_ltr ltr on node.fid_gencel = ltr.id
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_CONECTIVIDADE_SE_MT" ("ID", "PAC", "LOC_INST_SAP")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select pst.id,
       'SE-'||node.objectid pac,
       node.loc_inst_sap
from tab_node_sub node
     inner join gen_bdgd2019.vs_pri_poste_dist pst
           on node.fid_gencel = pst.id
union all
select pto.id,
       'SE-'||node.objectid pac,
       node.loc_inst_sap
from tab_node_sub node
     inner join gen_bdgd2019.vs_pri_pto_sustentacao pto
           on node.fid_gencel = pto.id
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_CONJ" ("COD_ID", "DIST", "NOM", "SIST_INTE", "SIST_SUBT", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT a.NR_CONJUNTO_ANEEL COD_ID,
'5697' DIST,
a.NM_CONJUNTO_CNS NOM,
1 SIST_INTE,
0 SIST_SUBT,
cast( null as varchar2(255) ) DESCR,
a.GEOMETRY
FROM VA_CONJUNTO_ANEEL a
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_CTAT" ("COD_ID", "NOM", "TEN_NOM", "DIST")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT SAP.NR_LINHA_TRMSS COD_ID,
       SAP.DS_LINHA_TRMSS NOM,
       DECODE(SAP.TN_NOM_LTR, 138, 94, 69, 82, -1) AS TEN_NOM,
       '5697' DIST--,
       --'' DESCR
FROM V_LINHA_TRMSS_GENESIS LTR
     LEFT JOIN TAB_SAP_LINHA_TRMSS SAP
          ON SAP.NR_LINHA_TRMSS = LTR.NR_LINHA_TRMSS
WHERE SAP.NR_LINHA_TRMSS IS NOT NULL AND SAP.NR_LINHA_TRMSS <> 045
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_CTMT" ("COD_ID", "NOM", "SUB", "PAC", "TEN_NOM", "DIST")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT ALI.CD_ALIMENTADOR COD_ID,
         ALI.NM_ALIMENTADOR NOM,
         --'' BAR,
        SUB.SG_SUBESTACAO SUB, 
        RDE.NR_PTO_ELET_INICIO PAC, 
        DECODE(ALI.ID_TN_NOMINAL_AL, 1, 49, 2, 62, 3, 72, 4, 35, -1) TEN_NOM, '5697' DIST--, 
        --'' UNI_TR_S, 
        --'' DESCR
FROM gen_bdgd2019.VS_PRI_ALIMENTADOR ALI
LEFT JOIN gen_bdgd2019.VS_PRI_SUBESTACAO SUB
    ON ALI.PRI_SUBESTACAO_ID = SUB.PRI_SUBESTACAO_ID
LEFT JOIN gen_bdgd2019.RDE_CONEC_CPR RDE
    ON RDE.FEATURE_ID = ALI.ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQCR" ("COD_ID", "PAC_1", "PAC_2", "SUB", "DESCR", "TI", "FID")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT SAP.NR_LOCALINST_SAP AS COD_ID,
         CONEC.NR_PTO_ELET_INICIO AS PAC_1,
         CONEC.NR_PTO_ELET_FIM AS PAC_2,
         VSSBT.SG_SUBESTACAO AS SUB,
         SAP.NR_LOCALINST_SAP AS DESCR,
        
    CASE
    WHEN PRI.ID_AREA_OBJETO='40' THEN
    40
    ELSE 41
    END AS TI, PRI.ID AS FID
FROM VS_PRI_BANCO_CAPCT_RD PRI
INNER JOIN TAB_SAP_BANCO_CAPCT_RD SAP
    ON PRI.NR_LOCZ_EQPTO_RD = SAP.NR_LOCZ_EQPTO_RD
        AND SAP.NR_REGIONAL=PRI.AREA_REGL_RSPDD_ID
LEFT JOIN RDE_CONEC_CPR CONEC
    ON CONEC.FEATURE_ID = PRI.ID
LEFT JOIN VS_PRI_ALIMENTADOR VSA
    ON VSA.PRI_ALIMENTADOR_ID=PRI.PRI_ALIMENTADOR_ID
LEFT JOIN Vs_PRI_SUBESTACAO VSSBT
    ON VSSBT.PRI_SUBESTACAO_ID=VSA.PRI_SUBESTACAO_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQME" ("NR_CONTA_CNS", "PAC", "RAMAL_LIGACAO")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT NR_CONTA_CNS,
       COALESCE(RCSE.NR_PTO_ELET_INICIO, RLTR.NR_PTO_ELET_INICIO, NULL) AS PAC,
       RLCNS.ID AS RAMAL_LIGACAO
  FROM   RDE_UND_CNS_EE UCEE
         INNER JOIN VS_PRI_RAMAL_LIG_CNS RLCNS
                 ON RLCNS.PRI_RAMAL_LIG_CNS_ID = UCEE.PRI_RAMAL_LIG_CNS_ID
         LEFT JOIN RDE_CONEC_CSE RCSE
                 ON RCSE.FEATURE_ID = RLCNS.ID
         LEFT JOIN RDE_CONEC_LTR RLTR
              ON RLTR.FEATURE_ID = RLCNS.ID
WHERE COALESCE(RCSE.NR_PTO_ELET_INICIO, RLTR.NR_PTO_ELET_INICIO, NULL) IS NOT NULL
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQME_2" ("NR_CONTA_CNS", "PAC")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT NR_CONTA_CNS,
       COALESCE(RCSE.NR_PTO_ELET_INICIO, RLTR.NR_PTO_ELET_INICIO, NULL) AS PAC
  FROM   RDE_UND_CNS_EE UCEE
         INNER JOIN VS_PRI_RAMAL_LIG_CNS RLCNS
                 ON RLCNS.PRI_RAMAL_LIG_CNS_ID = UCEE.PRI_RAMAL_LIG_CNS_ID
         LEFT JOIN RDE_CONEC_CSE RCSE
                 ON RCSE.FEATURE_ID = RLCNS.ID
         LEFT JOIN RDE_CONEC_LTR RLTR
              ON RLTR.FEATURE_ID = RLCNS.ID
WHERE COALESCE(RCSE.NR_PTO_ELET_INICIO, RLTR.NR_PTO_ELET_INICIO, NULL) IS NOT NULL

----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQME_BKP" ("NR_CONTA_CNS", "PAC")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT NR_CONTA_CNS,
         NR_PTO_ELET_INICIO AS PAC
  FROM   RDE_UND_CNS_EE UCEE
         INNER JOIN VS_PRI_RAMAL_LIG_CNS RLCNS
                 ON RLCNS.PRI_RAMAL_LIG_CNS_ID = UCEE.PRI_RAMAL_LIG_CNS_ID
         INNER JOIN RDE_CONEC_CSE RCSE
                 ON RCSE.FEATURE_ID = RLCNS.ID

----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQPTO_SUB" ("SUB", "NR_SUB", "CONJ", "MUNICIPIO", "ARE_LOC")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT SUB.SG_SUBESTACAO AS "SUB",
         SUB.NR_SUBESTACAO AS "NR_SUB",
         CONJ_ANEEL.NR_CONJUNTO_ANEEL AS "CONJ",
         MUN.NR_MUN_ELETROBRAS AS "MUNICIPIO",
         SUB.ID_AREA_OBJETO AS "ARE_LOC"
FROM VS_PRI_SUBESTACAO SUB
LEFT JOIN PRI_MUNICIPIO SUB_MUN
    ON SUB_MUN.ID = SUB.PRI_MUNICIPIO_ID
LEFT JOIN MUNICIPIO MUN
    ON MUN.ID = SUB_MUN.MUNICIPIO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ_ANEEL
    ON CONJ_ANEEL.PRI_CONJUNTO_CNS_ID = SUB.PRI_CONJUNTO_CNS_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQRE" ("COD_ID", "PAC_1", "PAC_2", "TIP_REGU", "ID_TIPO_LIGACAO_RG", "ID_AREA_OBJETO")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT SAP.NR_LOCALINST_SAP AS COD_ID,
         CONEC.NR_PTO_ELET_INICIO AS PAC_1,
         CONEC.NR_PTO_ELET_FIM AS PAC_2,
         'M' AS TIP_REGU, PRI.ID_TIPO_LIGACAO_RG, PRI.ID_AREA_OBJETO
FROM TAB_SAP_BANCO_REGDR_TN SAP
INNER JOIN VS_PRI_BANCO_REGDR_TN PRI
    ON PRI.NR_LOCZ_EQPTO_RD = SAP.NR_LOCZ_EQPTO_RD
        AND SAP.NR_REGIONAL=PRI.AREA_REGL_RSPDD_ID
LEFT JOIN RDE_CONEC_CPR CONEC
    ON CONEC.FEATURE_ID=PRI.ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQTRD" ("ID", "PAC1", "PAC2", "FAS_CON_P", "FAS_CON_S", "ARE_LOC", "CONJ", "POS", "TEN_LIN_SEC", "ALIMENTADOR", "MUNICIPIO", "SUB", "EQUIPAMENTO", "TIPO", "FASE", "TAP", "CR_NOMINAL_ELO", "MODELO_ELO", "GEOMETRY", "LOCZ", "REGIONAL", "ID_PRPR_TRAFO_DIST")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT TRAFO.ID,
         CON.NR_PTO_ELET_INICIO AS "PAC1",
         CON.NR_PTO_ELET_FIM AS "PAC2",
         --SUGERE.FASE_TRAFO_PRIMARIO AS "FAS_CON_P",
         --SUGERE.FASE_TRAFO_SECUNDARIO AS "FAS_CON_S",
         --SUGERE.FASE_TRAFO_TERCIARIO AS "FAS_CON_T",
         TRAFO.ID_FASE_LIGADA_TD AS "FAS_CON_P",
         TRAFO.ID_FASE_SECDR_TD AS "FAS_CON_S",
         TRAFO.ID_AREA_OBJETO AS "ARE_LOC",
         CONJ_ANEEL.NR_CONJUNTO_ANEEL AS "CONJ",
         TRAFO.ID_PRPR_TRAFO_DIST AS "POS",
         TSAP.TN_NOMINAL_SEC AS "TEN_LIN_SEC",
         ALIM.CD_ALIMENTADOR AS "ALIMENTADOR",
         MUN.NR_MUN_ELETROBRAS AS "MUNICIPIO" ,
         SUB.SG_SUBESTACAO AS "SUB",
         TSAP.NR_LOCALINST_SAP AS "EQUIPAMENTO",
         TRAFO.ID_TIPO AS "TIPO",
         TRAFO.ID_QTD_FASE_TD AS "FASE",
         TRAFO.TN_TAP_TD AS "TAP",
         TRAFO.CR_NOMINAL_ELO AS "CR_NOMINAL_ELO",
         TRAFO.DS_MODELO_ELO AS "MODELO_ELO",
         TRAFO.GEOMETRY AS "GEOMETRY",
         TRAFO.NR_LOCZ_EQPTO_RD AS "LOCZ",
         TRAFO.AREA_REGL_RSPDD_ID AS "REGIONAL",
         TRAFO.ID_PRPR_TRAFO_DIST
FROM VS_PRI_TRAFO_DIST TRAFO
LEFT JOIN RDE_CONEC_CPR CON
    ON CON.FEATURE_ID = TRAFO.ID
LEFT JOIN VS_PRI_ALIMENTADOR ALIM
    ON ALIM.PRI_ALIMENTADOR_ID = TRAFO.PRI_ALIMENTADOR_ID
LEFT JOIN PRI_MUNICIPIO PRI_MUN
    ON PRI_MUN.ID = TRAFO.PRI_MUNICIPIO_ID
LEFT JOIN MUNICIPIO MUN
    ON MUN.ID = PRI_MUN.MUNICIPIO_ID
LEFT JOIN VS_PRI_SUBESTACAO SUB
    ON SUB.PRI_SUBESTACAO_ID = ALIM.PRI_SUBESTACAO_ID
LEFT JOIN TAB_SAP_TRAFO_DIST TSAP
    ON TSAP.NR_LOCZ_EQPTO_RD = TRAFO.NR_LOCZ_EQPTO_RD
        AND TSAP.NR_REGIONAL = TRAFO.AREA_REGL_RSPDD_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ_ANEEL
    ON CONJ_ANEEL.PRI_CONJUNTO_CNS_ID = TRAFO.PRI_CONJUNTO_CNS_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_EQTRD_PARTICULAR" ("ID", "PAC1", "PAC2", "FAS_CON_P", "POT_NOM", "FAS_CON_S", "ARE_LOC", "CONJ", "POS", "TEN_LIN_SEC", "ALIMENTADOR", "MUNICIPIO", "SUB", "EQUIPAMENTO", "TIPO", "FASE", "TAP", "CR_NOMINAL_ELO", "MODELO_ELO", "GEOMETRY", "LOCZ", "REGIONAL")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT TRAFO.ID,
         CON.NR_PTO_ELET_INICIO AS "PAC1",
         CON.NR_PTO_ELET_FIM AS "PAC2",
         TRAFO.ID_FASE_LIGADA_TD AS "FAS_CON_P",
        TRAFO.PO_NOMINAL_TD AS "POT_NOM",
         TRAFO.ID_FASE_SECDR_TD AS "FAS_CON_S",
         TRAFO.ID_AREA_OBJETO AS "ARE_LOC",
         CONJ_ANEEL.NR_CONJUNTO_ANEEL AS "CONJ",
         TRAFO.ID_PRPR_TRAFO_DIST AS "POS",
         TRAFO.ID_TN_NOM_SAIDA_TD AS "TEN_LIN_SEC",
         ALIM.CD_ALIMENTADOR AS "ALIMENTADOR",
         MUN.NR_MUN_ELETROBRAS AS "MUNICIPIO" ,
         SUB.SG_SUBESTACAO AS "SUB",
         TSAP.NR_LOCALINST_SAP AS "EQUIPAMENTO",
         TRAFO.ID_TIPO AS "TIPO",
         TRAFO.ID_QTD_FASE_TD AS "FASE",
         TRAFO.TN_TAP_TD AS "TAP",
         TRAFO.CR_NOMINAL_ELO AS "CR_NOMINAL_ELO",
         TRAFO.DS_MODELO_ELO AS "MODELO_ELO",
         TRAFO.GEOMETRY AS "GEOMETRY",
         TRAFO.NR_LOCZ_EQPTO_RD AS "LOCZ",
         TRAFO.AREA_REGL_RSPDD_ID AS "REGIONAL"
FROM VS_PRI_TRAFO_DIST TRAFO
LEFT JOIN RDE_CONEC_CSE CON
    ON CON.FEATURE_ID = TRAFO.ID
LEFT JOIN VS_PRI_ALIMENTADOR ALIM
    ON ALIM.PRI_ALIMENTADOR_ID = TRAFO.PRI_ALIMENTADOR_ID
LEFT JOIN PRI_MUNICIPIO PRI_MUN
    ON PRI_MUN.ID = TRAFO.PRI_MUNICIPIO_ID
LEFT JOIN MUNICIPIO MUN
    ON MUN.ID = PRI_MUN.MUNICIPIO_ID
LEFT JOIN VS_PRI_SUBESTACAO SUB
    ON SUB.PRI_SUBESTACAO_ID = ALIM.PRI_SUBESTACAO_ID
LEFT JOIN TAB_SAP_CHAVE_FUSIVEL TSAP
    ON TSAP.NR_LOCZ_EQPTO_RD = TRAFO.NR_LOCZ_EQPTO_RD
        AND TSAP.NR_REGIONAL = TRAFO.AREA_REGL_RSPDD_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ_ANEEL
    ON CONJ_ANEEL.PRI_CONJUNTO_CNS_ID = TRAFO.PRI_CONJUNTO_CNS_ID
WHERE TRAFO.ID_PRPR_TRAFO_DIST = 2
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_ERRO_FASE_MT" ("FEATURE_ID", "FEATURE_TYPE", "PRI_ALIMENTADOR_ID", "LEVEL", "FASE_OBJETO", "FASE_PAI", "STATUS_FASE")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT CONEC.*,
CASE 
WHEN (REGEXP_LIKE(FASE_PAI, '(.*['||FASE_OBJETO ||'].*){'|| LENGTH(FASE_OBJETO) ||'}') OR FASE_PAI = '0') THEN 'OK'
ELSE 'ERRO'
END AS STATUS_FASE
FROM 
(SELECT 
REDE_MT.FEATURE_ID,
REDE_MT.FEATURE_TYPE,
REDE_MT.PRI_ALIMENTADOR_ID,
REDE_MT."LEVEL",
B.FASE AS FASE_OBJETO,
PAI.FASE AS "FASE_PAI"
FROM MV_GENESIS_AUD_REDE_MT REDE_MT 
INNER JOIN MV_GENESIS_ALIMENTADORES ALIM
ON ALIM.PRI_ALIMENTADOR_ID = REDE_MT.PRI_ALIMENTADOR_ID
INNER JOIN MV_PRE_FASE_MT B
ON FEATURE_ID = B.ID  
INNER JOIN RDE_CONEC_CPR RDE
ON RDE.NR_PTO_ELET_FIM = REDE_MT.PAC_PAI
INNER JOIN MV_PRE_FASE_MT PAI
ON PAI.ID = RDE.FEATURE_ID) CONEC
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_FLY_TAP_BT" ("PAC_1", "PAC_2", "FEATURE_ID")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT A.NR_PTO_ELET_INICIO PAC_1, A.NR_PTO_ELET_FIM PAC_2, FEATURE_ID FROM RDE_CONEC_CSE A WHERE A.FEATURE_TYPE = 'FlyTapSecundario'
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_FLY_TAP_MT" ("PAC_1", "PAC_2", "FEATURE_ID")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select A.NR_PTO_ELET_INICIO PAC_1, A.NR_PTO_ELET_FIM PAC_2, FEATURE_ID from RDE_CONEC_CPR A WHERE A.FEATURE_TYPE = 'FlyTap'
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_PIP" ("COD_ID", "DIST", "MUN", "CONJ", "SUB", "CTMT", "UNI_TR_D", "PN_CON", "CLAS_SUB", "FAS_CON", "GRU_TEN", "TEN_FORN", "GRU_TAR", "SIT_ATIV", "ARE_LOC", "PAC", "TIP_CC", "CAR_INST", "ENE_01", "ENE_02", "ENE_03", "ENE_04", "ENE_05", "ENE_06", "ENE_07", "ENE_08", "ENE_09", "ENE_10", "ENE_11", "ENE_12", "DIC", "FIC", "LIV", "SEMRED", "DAT_CON", "DESCR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT A.ID COD_ID,
       '5697' DIST,
       MUN.NR_MUN_ANEEL MUN,
       NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       --NULL UNI_TR_S,
       ALI.CD_ALIMENTADOR CTMT,
       NVL(TFD.ID, 0) UNI_TR_D,
       FIX_PN.FEATURE_ID PN_CON,
       'IP' CLAS_SUB,
       /*DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN',
                                                                 2, 'BN',
                                                                 3, 'CN', '0') FAS_CON,*/
       --TFD.ID_FASE_LIGADA_TD,                                                                                       --ESSE 3 ¿ CONTROLE DE ERROS
       DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN', 2, 'BN', 3, 'AN', '-1'),
                                     2, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'BN', 2, 'CN', '-1'),
                                     3, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'CN', 2, 'AN', '-1'),
                                     4, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN', 2, 'BN', '-1'),
                                     5, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'BN', 2, 'CN', '-1'),
                                     6, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'CN', 2, 'AN', '-1'),
                                     7, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN', 2, 'BN', 3, 'CN', '-1'),
              '-2') FAS_CON,
       'BT' GRU_TEN,
       '10' TEN_FORN,
       'B4A' GRU_TAR,
       'AT' SIT_ATIV,
       DECODE(A.ID_AREA_OBJETO,
              'U', 'UB',
              'R', 'NU') ARE_LOC,
       RDE.NR_PTO_ELET_INICIO PAC,
       'IP-TIPO1' TIP_CC,
       TP_LUM.PO_LUMINARIA CAR_INST,
       ENE.CONS_DIARIO_KWH*31 ENE_01,
       ENE.CONS_DIARIO_KWH*28 ENE_02,
       ENE.CONS_DIARIO_KWH*31 ENE_03,
       ENE.CONS_DIARIO_KWH*30 ENE_04,
       ENE.CONS_DIARIO_KWH*31 ENE_05,
       ENE.CONS_DIARIO_KWH*30 ENE_06,
       ENE.CONS_DIARIO_KWH*31 ENE_07,
       ENE.CONS_DIARIO_KWH*31 ENE_08,
       ENE.CONS_DIARIO_KWH*30 ENE_09,
       ENE.CONS_DIARIO_KWH*31 ENE_10,
       ENE.CONS_DIARIO_KWH*30 ENE_11,
       ENE.CONS_DIARIO_KWH*31 ENE_12,
       nvl(SIMO.DIC, 0) DIC,
       nvl(SIMO.FIC, 0) FIC,
       '0' LIV,
       '1' SEMRED,
       TO_DATE('01/01/2018', 'DD/MM/YYYY') DAT_CON,
       SAP_TFD.NR_LOCALINST_SAP || ', COMANDO' DESCR--,
       --A.GEOMETRY
FROM (SELECT * FROM VS_PRI_CGA_ILUM_PUBL WHERE PRI_CMDO_ILUM_PUBL_ID IS NOT NULL) A
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON A.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON A.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
     LEFT JOIN VS_PRI_CMDO_ILUM_PUBL CMDO
          ON CMDO.PRI_CMDO_ILUM_PUBL_ID = A.PRI_CMDO_ILUM_PUBL_ID
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.PRI_TRAFO_DIST_ID = CMDO.PRI_TRAFO_DIST_ID
     LEFT JOIN TAB_SAP_TRAFO_DIST SAP_TFD
          ON SAP_TFD.NR_LOCALINST_GEN = TFD.NR_LOCALINST_GEN
     LEFT JOIN PRI_ALIMENTADOR ALI
          ON ALI.ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN PRI_SUBESTACAO SUB
          ON SUB.ID = ALI.PRI_SUBESTACAO_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON A.ID = FIX.FEATURE_ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX.ID_CR_ACC_POINT_1 = FIX_PN.ID
     LEFT JOIN RDE_CONEC_CSE RDE
          ON RDE.FEATURE_ID = CMDO.ID
     LEFT JOIN TIPO_LUMINARIA TP_LUM
          ON TP_LUM.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN CAD_ENERGIA_PIP ENE
          ON ENE.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN SIMO3.GENESIS_EQPTO_DIC_FIC@PSIMOCOD SIMO
          ON SIMO.NR_EQUIPAMENTO_INTERROMPIDO = TFD.NR_LOCZ_EQPTO_RD
             AND TFD.AREA_REGL_RSPDD_ID = SIMO.NR_REGIONAL
     LEFT JOIN V_AUX_FASE_COMANDO_PIP_2 FASE
          ON FASE.CMDO_ID = CMDO.PRI_CMDO_ILUM_PUBL_ID
             AND A.ID = FASE.PIP_FID
WHERE CMDO.PRI_TRAFO_DIST_ID IS NOT NULL
UNION ALL

SELECT A.ID COD_ID,
       '5697' DIST,
       MUN.NR_MUN_ANEEL MUN,
       NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       --NULL UNI_TR_S,
       NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
       NVL(TFD.ID, 0) UNI_TR_D,
       FIX_PN.FEATURE_ID PN_CON,
       'IP' CLAS_SUB,
       /*DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN',
                                    2, 'BN',
                                    3, 'CN') FAS_CON,*/
       --TFD.ID_FASE_LIGADA_TD,                                                         --ESSE 3 ¿ CONTROLE DE ERROS
       DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'AN', '-1'),
                                     2, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', 3, 'BN', '-1'),
                                     3, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', 3, 'CN', '-1'),
                                     4, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', '-1'),
                                     5, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', '-1'),
                                     6, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', '-1'),
                                     7, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'CN', '-1'),
              '-2') FAS_CON,
       'BT' GRU_TEN,
       '10' TEN_FORN,
       'B4A' GRU_TAR,
       'AT' SIT_ATIV,
       DECODE(A.ID_AREA_OBJETO,
              'U', 'UB',
              'R', 'NU') ARE_LOC,
       COALESCE(BY_PASS_CMDO.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO) PAC,
       'IP-TIPO1' TIP_CC,
       TP_LUM.PO_LUMINARIA CAR_INST,
       ENE.CONS_DIARIO_KWH*31 ENE_01,
       ENE.CONS_DIARIO_KWH*28 ENE_02,
       ENE.CONS_DIARIO_KWH*31 ENE_03,
       ENE.CONS_DIARIO_KWH*30 ENE_04,
       ENE.CONS_DIARIO_KWH*31 ENE_05,
       ENE.CONS_DIARIO_KWH*30 ENE_06,
       ENE.CONS_DIARIO_KWH*31 ENE_07,
       ENE.CONS_DIARIO_KWH*31 ENE_08,
       ENE.CONS_DIARIO_KWH*30 ENE_09,
       ENE.CONS_DIARIO_KWH*31 ENE_10,
       ENE.CONS_DIARIO_KWH*30 ENE_11,
       ENE.CONS_DIARIO_KWH*31 ENE_12,
       nvl(SIMO.DIC, 0) DIC,
       nvl(SIMO.FIC, 0) FIC,
       '0' LIV,
       '1' SEMRED,
       TO_DATE('01/01/2018', 'DD/MM/YYYY') DAT_CON,
       SAP_TFD.NR_LOCALINST_SAP || ', N?O COMANDO'  DESCR--,
       --A.GEOMETRY
FROM (SELECT * FROM VS_PRI_CGA_ILUM_PUBL WHERE PRI_CMDO_ILUM_PUBL_ID IS NULL) A
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON A.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON A.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
     LEFT JOIN MV_TRAFO_ILUM_SEM_CMDO I_TFD
          ON I_TFD.ILUM_FID = A.ID
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.ID = I_TFD.TRAFO_FID
     LEFT JOIN TAB_SAP_TRAFO_DIST SAP_TFD
          ON SAP_TFD.NR_LOCALINST_GEN = TFD.NR_LOCALINST_GEN
     LEFT JOIN PRI_ALIMENTADOR ALI
          ON ALI.ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN PRI_SUBESTACAO SUB
          ON SUB.ID = ALI.PRI_SUBESTACAO_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON A.ID = FIX.FEATURE_ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX.ID_CR_ACC_POINT_1 = FIX_PN.ID
     LEFT JOIN RDE_CONEC_CSE RDE
          ON RDE.FEATURE_ID = A.ID
     LEFT JOIN TIPO_LUMINARIA TP_LUM
          ON TP_LUM.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN CAD_ENERGIA_PIP ENE
          ON ENE.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN SIMO3.GENESIS_EQPTO_DIC_FIC@PSIMOCOD SIMO
          ON SIMO.NR_EQUIPAMENTO_INTERROMPIDO = TFD.NR_LOCZ_EQPTO_RD
             AND TFD.AREA_REGL_RSPDD_ID = SIMO.NR_REGIONAL
     LEFT JOIN BDGD.VAUX_BY_PASS_COMANDO_IP BY_PASS_CMDO
          ON BY_PASS_CMDO.NR_PTO_ELET_FIM = RDE.NR_PTO_ELET_INICIO
WHERE I_TFD.TRAFO_FID IS NOT NULL
      and TFD.id IS NOT NULL

UNION ALL

SELECT A.ID COD_ID,
       '5697' DIST,
       MUN.NR_MUN_ANEEL MUN,
       NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       --NULL UNI_TR_S,
       NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
       NVL(TFD.ID, 0) UNI_TR_D,
       FIX_PN.FEATURE_ID PN_CON,
       'IP' CLAS_SUB,
       /*DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN',
                                    2, 'BN',
                                    3, 'CN') FAS_CON,*/
       --TFD.ID_FASE_LIGADA_TD,                                                         --ESSE 3 ¿ CONTROLE DE ERROS
       DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'AN', '-1'),
                                     2, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', 3, 'BN', '-1'),
                                     3, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', 3, 'CN', '-1'),
                                     4, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', '-1'),
                                     5, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', '-1'),
                                     6, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', '-1'),
                                     7, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'CN', '-1'),
              '-2') FAS_CON,
       'BT' GRU_TEN,
       '10' TEN_FORN,
       'B4A' GRU_TAR,
       'AT' SIT_ATIV,
       DECODE(A.ID_AREA_OBJETO,
              'U', 'UB',
              'R', 'NU') ARE_LOC,
       COALESCE(BY_PASS_CMDO.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO) PAC,
       --RDE.NR_PTO_ELET_INICIO PAC,
       'IP-TIPO1' TIP_CC,
       TP_LUM.PO_LUMINARIA CAR_INST,
       ENE.CONS_DIARIO_KWH*31 ENE_01,
       ENE.CONS_DIARIO_KWH*28 ENE_02,
       ENE.CONS_DIARIO_KWH*31 ENE_03,
       ENE.CONS_DIARIO_KWH*30 ENE_04,
       ENE.CONS_DIARIO_KWH*31 ENE_05,
       ENE.CONS_DIARIO_KWH*30 ENE_06,
       ENE.CONS_DIARIO_KWH*31 ENE_07,
       ENE.CONS_DIARIO_KWH*31 ENE_08,
       ENE.CONS_DIARIO_KWH*30 ENE_09,
       ENE.CONS_DIARIO_KWH*31 ENE_10,
       ENE.CONS_DIARIO_KWH*30 ENE_11,
       ENE.CONS_DIARIO_KWH*31 ENE_12,
       nvl(SIMO.DIC, 0) DIC,
       nvl(SIMO.FIC, 0) FIC,
       '0' LIV,
       '1' SEMRED,
       TO_DATE('01/01/2018', 'DD/MM/YYYY') DAT_CON,
       SAP_TFD.NR_LOCALINST_SAP || ', SPECIAL'  DESCR--,
       --A.GEOMETRY
FROM (SELECT A.*
FROM VS_PRI_CGA_ILUM_PUBL A
     INNER JOIN VS_PRI_CMDO_ILUM_PUBL B
          ON A.PRI_CMDO_ILUM_PUBL_ID = B.PRI_CMDO_ILUM_PUBL_ID
WHERE B.PRI_TRAFO_DIST_ID IS NULL
UNION ALL
SELECT A.*
FROM (SELECT * FROM VS_PRI_CGA_ILUM_PUBL A WHERE A.PRI_CMDO_ILUM_PUBL_ID IS NULL) A
     LEFT JOIN MV_TRAFO_ILUM_SEM_CMDO C
          ON A.ID = C.ILUM_FID
WHERE C.TRAFO_FID IS NULL) A
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON A.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON A.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
     LEFT JOIN gen_bdgd2019.tAB_AUX_PIP_TFD I_TFD
          ON I_TFD.FID_PIP = A.ID
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.PRI_TRAFO_DIST_ID = I_TFD.fID_TFD
     LEFT JOIN TAB_SAP_TRAFO_DIST SAP_TFD
          ON SAP_TFD.NR_LOCALINST_GEN = TFD.NR_LOCALINST_GEN
     LEFT JOIN PRI_ALIMENTADOR ALI
          ON ALI.ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN PRI_SUBESTACAO SUB
          ON SUB.ID = ALI.PRI_SUBESTACAO_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON A.ID = FIX.FEATURE_ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX.ID_CR_ACC_POINT_1 = FIX_PN.ID
     LEFT JOIN RDE_CONEC_CSE RDE
          ON RDE.FEATURE_ID = A.ID
     LEFT JOIN TIPO_LUMINARIA TP_LUM
          ON TP_LUM.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN CAD_ENERGIA_PIP ENE
          ON ENE.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN SIMO3.GENESIS_EQPTO_DIC_FIC@PSIMOCOD SIMO
          ON SIMO.NR_EQUIPAMENTO_INTERROMPIDO = TFD.NR_LOCZ_EQPTO_RD
             AND TFD.AREA_REGL_RSPDD_ID = SIMO.NR_REGIONAL
     LEFT JOIN BDGD.VAUX_BY_PASS_COMANDO_IP BY_PASS_CMDO
          ON BY_PASS_CMDO.NR_PTO_ELET_FIM = RDE.NR_PTO_ELET_INICIO
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_PIP_TST" ("COD_ID", "DIST", "MUN", "CONJ", "SUB", "CTMT", "UNI_TR_D", "PN_CON", "CLAS_SUB", "FAS_CON", "ID_FASE_LIGADA_TD", "FAS_CON_2", "GRU_TEN", "TEN_FORN", "GRU_TAR", "SIT_ATIV", "ARE_LOC", "PAC", "TIP_CC", "CAR_INST", "ENE_01", "ENE_02", "ENE_03", "ENE_04", "ENE_05", "ENE_06", "ENE_07", "ENE_08", "ENE_09", "ENE_10", "ENE_11", "ENE_12", "DIC", "FIC", "LIV", "SEMRED", "DAT_CON", "DESCR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT A.ID COD_ID,
       '5697' DIST,
       MUN.NR_MUN_ANEEL MUN,
       NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       --NULL UNI_TR_S,
       ALI.CD_ALIMENTADOR CTMT,
       NVL(TFD.ID, 0) UNI_TR_D,
       FIX_PN.FEATURE_ID PN_CON,
       'IP' CLAS_SUB,
       DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN',
                                                                 2, 'BN',
                                                                 3, 'CN', '0') FAS_CON,
       TFD.ID_FASE_LIGADA_TD,                                                                                       --ESSE 3 ¿ CONTROLE DE ERROS
       DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN', 2, 'BN', 3, 'AN', '-1'),
                                     2, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'BN', 2, 'CN', '-1'),
                                     3, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'CN', 2, 'AN', '-1'),
                                     4, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN', 2, 'BN', '-1'),
                                     5, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'BN', 2, 'CN', '-1'),
                                     6, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'CN', 2, 'AN', '-1'),
                                     7, DECODE(COALESCE(FASE.ID_FASE_NOVA, CMDO.ID_FASE_LIG_CIP), 1, 'AN', 2, 'BN', 3, 'CN', '-1'),
              '-2') FAS_CON_2,
       'BT' GRU_TEN,
       '10' TEN_FORN,
       'B4A' GRU_TAR,
       'AT' SIT_ATIV,
       DECODE(A.ID_AREA_OBJETO,
              'U', 'UB',
              'R', 'NU') ARE_LOC,
       RDE.NR_PTO_ELET_INICIO PAC,
       'IP-TIPO1' TIP_CC,
       TP_LUM.PO_LUMINARIA CAR_INST,
       ENE.CONS_DIARIO_KWH*31 ENE_01,
       ENE.CONS_DIARIO_KWH*28 ENE_02,
       ENE.CONS_DIARIO_KWH*31 ENE_03,
       ENE.CONS_DIARIO_KWH*30 ENE_04,
       ENE.CONS_DIARIO_KWH*31 ENE_05,
       ENE.CONS_DIARIO_KWH*30 ENE_06,
       ENE.CONS_DIARIO_KWH*31 ENE_07,
       ENE.CONS_DIARIO_KWH*31 ENE_08,
       ENE.CONS_DIARIO_KWH*30 ENE_09,
       ENE.CONS_DIARIO_KWH*31 ENE_10,
       ENE.CONS_DIARIO_KWH*30 ENE_11,
       ENE.CONS_DIARIO_KWH*31 ENE_12,
       nvl(SIMO.DIC, 0) DIC,
       nvl(SIMO.FIC, 0) FIC,
       '0' LIV,
       '1' SEMRED,
       TO_DATE('01/01/2018', 'DD/MM/YYYY') DAT_CON,
       SAP_TFD.NR_LOCALINST_SAP || ', COMANDO' DESCR--,
       --A.GEOMETRY
FROM (SELECT * FROM VS_PRI_CGA_ILUM_PUBL WHERE PRI_CMDO_ILUM_PUBL_ID IS NOT NULL) A
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON A.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON A.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
     LEFT JOIN VS_PRI_CMDO_ILUM_PUBL CMDO
          ON CMDO.PRI_CMDO_ILUM_PUBL_ID = A.PRI_CMDO_ILUM_PUBL_ID
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.PRI_TRAFO_DIST_ID = CMDO.PRI_TRAFO_DIST_ID
     LEFT JOIN TAB_SAP_TRAFO_DIST SAP_TFD
          ON SAP_TFD.NR_LOCALINST_GEN = TFD.NR_LOCALINST_GEN
     LEFT JOIN PRI_ALIMENTADOR ALI
          ON ALI.ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN PRI_SUBESTACAO SUB
          ON SUB.ID = ALI.PRI_SUBESTACAO_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON A.ID = FIX.FEATURE_ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX.ID_CR_ACC_POINT_1 = FIX_PN.ID
     LEFT JOIN RDE_CONEC_CSE RDE
          ON RDE.FEATURE_ID = CMDO.ID
     LEFT JOIN TIPO_LUMINARIA TP_LUM
          ON TP_LUM.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN CAD_ENERGIA_PIP ENE
          ON ENE.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN SIMO3.GENESIS_EQPTO_DIC_FIC@PSIMOCOD SIMO
          ON SIMO.NR_EQUIPAMENTO_INTERROMPIDO = TFD.NR_LOCZ_EQPTO_RD
             AND TFD.AREA_REGL_RSPDD_ID = SIMO.NR_REGIONAL
     LEFT JOIN V_AUX_FASE_COMANDO_PIP_2 FASE
          ON FASE.CMDO_ID = CMDO.PRI_CMDO_ILUM_PUBL_ID
             AND A.ID = FASE.PIP_FID
WHERE CMDO.PRI_TRAFO_DIST_ID IS NOT NULL
UNION ALL

SELECT A.ID COD_ID,
       '5697' DIST,
       MUN.NR_MUN_ANEEL MUN,
       NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       --NULL UNI_TR_S,
       NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
       NVL(TFD.ID, 0) UNI_TR_D,
       FIX_PN.FEATURE_ID PN_CON,
       'IP' CLAS_SUB,
       DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN',
                                    2, 'BN',
                                    3, 'CN') FAS_CON,
       TFD.ID_FASE_LIGADA_TD,                                                         --ESSE 3 ¿ CONTROLE DE ERROS
       DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'AN', '-1'),
                                     2, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', '-1'),
                                     3, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', '-1'),
                                     4, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', '-1'),
                                     5, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', '-1'),
                                     6, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', '-1'),
                                     7, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'CN', '-1'),
              '-2') FAS_CON_2,
       'BT' GRU_TEN,
       '10' TEN_FORN,
       'B4A' GRU_TAR,
       'AT' SIT_ATIV,
       DECODE(A.ID_AREA_OBJETO,
              'U', 'UB',
              'R', 'NU') ARE_LOC,
       COALESCE(BY_PASS_CMDO.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO) PAC,
       'IP-TIPO1' TIP_CC,
       TP_LUM.PO_LUMINARIA CAR_INST,
       ENE.CONS_DIARIO_KWH*31 ENE_01,
       ENE.CONS_DIARIO_KWH*28 ENE_02,
       ENE.CONS_DIARIO_KWH*31 ENE_03,
       ENE.CONS_DIARIO_KWH*30 ENE_04,
       ENE.CONS_DIARIO_KWH*31 ENE_05,
       ENE.CONS_DIARIO_KWH*30 ENE_06,
       ENE.CONS_DIARIO_KWH*31 ENE_07,
       ENE.CONS_DIARIO_KWH*31 ENE_08,
       ENE.CONS_DIARIO_KWH*30 ENE_09,
       ENE.CONS_DIARIO_KWH*31 ENE_10,
       ENE.CONS_DIARIO_KWH*30 ENE_11,
       ENE.CONS_DIARIO_KWH*31 ENE_12,
       nvl(SIMO.DIC, 0) DIC,
       nvl(SIMO.FIC, 0) FIC,
       '0' LIV,
       '1' SEMRED,
       TO_DATE('01/01/2018', 'DD/MM/YYYY') DAT_CON,
       SAP_TFD.NR_LOCALINST_SAP || ', N?O COMANDO'  DESCR--,
       --A.GEOMETRY
FROM (SELECT * FROM VS_PRI_CGA_ILUM_PUBL WHERE PRI_CMDO_ILUM_PUBL_ID IS NULL) A
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON A.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON A.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
     LEFT JOIN MV_TRAFO_ILUM_SEM_CMDO I_TFD
          ON I_TFD.ILUM_FID = A.ID
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.ID = I_TFD.TRAFO_FID
     LEFT JOIN TAB_SAP_TRAFO_DIST SAP_TFD
          ON SAP_TFD.NR_LOCALINST_GEN = TFD.NR_LOCALINST_GEN
     LEFT JOIN PRI_ALIMENTADOR ALI
          ON ALI.ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN PRI_SUBESTACAO SUB
          ON SUB.ID = ALI.PRI_SUBESTACAO_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON A.ID = FIX.FEATURE_ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX.ID_CR_ACC_POINT_1 = FIX_PN.ID
     LEFT JOIN RDE_CONEC_CSE RDE
          ON RDE.FEATURE_ID = A.ID
     LEFT JOIN TIPO_LUMINARIA TP_LUM
          ON TP_LUM.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN CAD_ENERGIA_PIP ENE
          ON ENE.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN SIMO3.GENESIS_EQPTO_DIC_FIC@PSIMOCOD SIMO
          ON SIMO.NR_EQUIPAMENTO_INTERROMPIDO = TFD.NR_LOCZ_EQPTO_RD
             AND TFD.AREA_REGL_RSPDD_ID = SIMO.NR_REGIONAL
     LEFT JOIN BDGD.VAUX_BY_PASS_COMANDO_IP BY_PASS_CMDO
          ON BY_PASS_CMDO.NR_PTO_ELET_FIM = RDE.NR_PTO_ELET_INICIO
WHERE I_TFD.TRAFO_FID IS NOT NULL
      and TFD.id IS NOT NULL

UNION ALL

SELECT A.ID COD_ID,
       '5697' DIST,
       MUN.NR_MUN_ANEEL MUN,
       NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       --NULL UNI_TR_S,
       NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
       NVL(TFD.ID, 0) UNI_TR_D,
       FIX_PN.FEATURE_ID PN_CON,
       'IP' CLAS_SUB,
       DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN',
                                    2, 'BN',
                                    3, 'CN') FAS_CON,
       TFD.ID_FASE_LIGADA_TD,                                                         --ESSE 3 ¿ CONTROLE DE ERROS
       DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'AN', '-1'),
                                     2, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', '-1'),
                                     3, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', '-1'),
                                     4, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', '-1'),
                                     5, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'BN', 2, 'CN', '-1'),
                                     6, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'CN', 2, 'AN', '-1'),
                                     7, DECODE(A.ID_FASE_IP_PTO_SEC, 1, 'AN', 2, 'BN', 3, 'CN', '-1'),
              '-2') FAS_CON_2,
       'BT' GRU_TEN,
       '10' TEN_FORN,
       'B4A' GRU_TAR,
       'AT' SIT_ATIV,
       DECODE(A.ID_AREA_OBJETO,
              'U', 'UB',
              'R', 'NU') ARE_LOC,
       COALESCE(BY_PASS_CMDO.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO) PAC,
       --RDE.NR_PTO_ELET_INICIO PAC,
       'IP-TIPO1' TIP_CC,
       TP_LUM.PO_LUMINARIA CAR_INST,
       ENE.CONS_DIARIO_KWH*31 ENE_01,
       ENE.CONS_DIARIO_KWH*28 ENE_02,
       ENE.CONS_DIARIO_KWH*31 ENE_03,
       ENE.CONS_DIARIO_KWH*30 ENE_04,
       ENE.CONS_DIARIO_KWH*31 ENE_05,
       ENE.CONS_DIARIO_KWH*30 ENE_06,
       ENE.CONS_DIARIO_KWH*31 ENE_07,
       ENE.CONS_DIARIO_KWH*31 ENE_08,
       ENE.CONS_DIARIO_KWH*30 ENE_09,
       ENE.CONS_DIARIO_KWH*31 ENE_10,
       ENE.CONS_DIARIO_KWH*30 ENE_11,
       ENE.CONS_DIARIO_KWH*31 ENE_12,
       nvl(SIMO.DIC, 0) DIC,
       nvl(SIMO.FIC, 0) FIC,
       '0' LIV,
       '1' SEMRED,
       TO_DATE('01/01/2018', 'DD/MM/YYYY') DAT_CON,
       SAP_TFD.NR_LOCALINST_SAP || ', SPECIAL'  DESCR--,
       --A.GEOMETRY
FROM (SELECT A.*
FROM VS_PRI_CGA_ILUM_PUBL A
     INNER JOIN VS_PRI_CMDO_ILUM_PUBL B
          ON A.PRI_CMDO_ILUM_PUBL_ID = B.PRI_CMDO_ILUM_PUBL_ID
WHERE B.PRI_TRAFO_DIST_ID IS NULL
UNION ALL
SELECT A.*
FROM (SELECT * FROM VS_PRI_CGA_ILUM_PUBL A WHERE A.PRI_CMDO_ILUM_PUBL_ID IS NULL) A
     LEFT JOIN MV_TRAFO_ILUM_SEM_CMDO C
          ON A.ID = C.ILUM_FID
WHERE C.TRAFO_FID IS NULL) A
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON A.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON A.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
     LEFT JOIN TAB_AUX_PIP_TFD I_TFD
          ON I_TFD.FID_PIP = A.ID
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.PRI_TRAFO_DIST_ID = I_TFD.ID_TFD
     LEFT JOIN TAB_SAP_TRAFO_DIST SAP_TFD
          ON SAP_TFD.NR_LOCALINST_GEN = TFD.NR_LOCALINST_GEN
     LEFT JOIN PRI_ALIMENTADOR ALI
          ON ALI.ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN PRI_SUBESTACAO SUB
          ON SUB.ID = ALI.PRI_SUBESTACAO_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON A.ID = FIX.FEATURE_ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX.ID_CR_ACC_POINT_1 = FIX_PN.ID
     LEFT JOIN RDE_CONEC_CSE RDE
          ON RDE.FEATURE_ID = A.ID
     LEFT JOIN TIPO_LUMINARIA TP_LUM
          ON TP_LUM.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN CAD_ENERGIA_PIP ENE
          ON ENE.ID = A.TIPO_LUMINARIA_ID
     LEFT JOIN SIMO3.GENESIS_EQPTO_DIC_FIC@PSIMOCOD SIMO
          ON SIMO.NR_EQUIPAMENTO_INTERROMPIDO = TFD.NR_LOCZ_EQPTO_RD
             AND TFD.AREA_REGL_RSPDD_ID = SIMO.NR_REGIONAL
     LEFT JOIN BDGD.VAUX_BY_PASS_COMANDO_IP BY_PASS_CMDO
          ON BY_PASS_CMDO.NR_PTO_ELET_FIM = RDE.NR_PTO_ELET_INICIO
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_PONNOT" ("COD_ID", "DIST", "TIP_PN", "POS", "ESTR", "MAT", "ESF", "ALT", "ARE_LOC", "CONJ", "MUN", "ODI", "TI", "CM", "TUC", "A1", "A2", "A3", "A4", "A5", "A6", "SITCONT", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_ALIMENTADOR
UNION
ALL
SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_CAIXA_SUBTERRANEA
UNION
ALL
SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_FLY_TAP
UNION
ALL
SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_PTO_SUSTENTACAO
UNION
ALL
SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_POSTE_DIST
UNION
ALL
SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_ESTRUTURA_LTR
UNION
ALL
SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_PORTICO
UNION
ALL
SELECT "COD_ID",
"DIST",
"TIP_PN",
"POS",
"ESTR",
"MAT",
TRIM(ESF) as ESF,
TRIM(ALT) as ALT,
"ARE_LOC",
"CONJ",
"MUN",
"ODI",
"TI",
"CM",
"TUC",
"A1",
"A2",
"A3",
"A4",
"A5",
"A6",
"SITCONT",
"DESCR",
"GEOMETRY"
FROM V_BDGD_PRI_DESCONHECIDO
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_QDP" ("ID", "PAC_1", "PAC_2")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT QDP.ID,
         CONEC.NR_PTO_ELET_INICIO PAC_1,
         CONEC.NR_PTO_ELET_FIM PAC_2
FROM VS_PRI_QDP QDP
LEFT JOIN RDE_CONEC_CSE CONEC
    ON CONEC.FEATURE_ID = QDP.ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_RAM_LIG" ("ID", "CONTA", "FASE", "PN_CON", "PAC1", "PAC2", "RAMAL", "TRANSFORMADOR", "ALIMENTADOR", "ARE_LOC", "SUBESTACAO", "CONJUNTO", "MUNICIPIO")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT RAMAL.ID AS "ID",
         RDE.NR_CONTA_CNS             AS "CONTA",
         SUGERE.FASE_SUGERIDA         AS "FASE",
         FIX.FEATURE_ID               AS "PN_CON",
         CASE
           WHEN TRAFDIST.ID IS NULL
                AND CONEC.NR_PTO_ELET_INICIO IS NOT NULL THEN 'BT-'
                                                              ||
           CAST(CONEC.NR_PTO_ELET_INICIO AS VARCHAR(50))
           WHEN TRAFDIST.ID IS NOT NULL
                AND CONEC.NR_PTO_ELET_INICIO IS NOT NULL THEN
           CAST(CONEC.NR_PTO_ELET_INICIO AS VARCHAR(50))
           ELSE NULL
         END                          AS "PAC1",
         CASE
           WHEN CONEC.NR_PTO_ELET_FIM IS NOT NULL THEN 'BT-'
                                                       ||CAST(
           CONEC.NR_PTO_ELET_FIM AS VARCHAR(50))
           ELSE NULL
         END                          AS PAC2,
         RAMAL.ID                     AS "RAMAL",
         TRAFO.ID                     AS "TRANSFORMADOR",
         ALIM.CD_ALIMENTADOR          AS "ALIMENTADOR",
         RAMAL.ID_AREA_OBJETO         AS "ARE_LOC",
         SUB.SG_SUBESTACAO            AS "SUBESTACAO",
         CONJ_ANEEL.NR_CONJUNTO_ANEEL AS "CONJUNTO",
         MUN.NR_MUN_ELETROBRAS        AS "MUNICIPIO"
  FROM   VS_PRI_RAMAL_LIG_CNS RAMAL
         INNER JOIN RDE_UND_CNS_RAMAL RDE
                 ON RDE.PRI_RAMAL_LIG_CNS_ID = RAMAL.PRI_RAMAL_LIG_CNS_ID
         LEFT JOIN RDE_CONEC_CSE CONEC
                ON CONEC.FEATURE_ID = RAMAL.ID
         LEFT JOIN VS_PRI_TRAFO_DIST TRAFO
                ON TRAFO.PRI_TRAFO_DIST_ID = RAMAL.PRI_TRAFO_DIST_ID
         LEFT JOIN VS_PRI_ALIMENTADOR ALIM
                ON ALIM.PRI_ALIMENTADOR_ID = TRAFO.PRI_ALIMENTADOR_ID
         LEFT JOIN VS_PRI_SUBESTACAO SUB
                ON SUB.PRI_SUBESTACAO_ID = ALIM.PRI_SUBESTACAO_ID
         LEFT JOIN VA_CONJUNTO_ANEEL CONJ_ANEEL
                ON CONJ_ANEEL.PRI_CONJUNTO_CNS_ID = RAMAL.PRI_CONJUNTO_CNS_ID
         LEFT JOIN PRI_MUNICIPIO PRI_MUN
                ON PRI_MUN.ID = RAMAL.PRI_MUNICIPIO_ID
         LEFT JOIN MUNICIPIO MUN
                ON MUN.ID = PRI_MUN.MUNICIPIO_ID
         LEFT JOIN CR_ACC_POINT_LINK FIX_LINK
                ON FIX_LINK.FEATURE_ID = RAMAL.ID
         LEFT JOIN CR_ACC_POINT FIX
                ON FIX_LINK.ID_CR_ACC_POINT_1 = FIX.ID
         LEFT JOIN (SELECT NR_PTO_ELET_FIM,
                           MAX(FEATURE_ID) AS FEATURE_ID
                    FROM   RDE_CONEC_CSE
                    GROUP  BY NR_PTO_ELET_FIM) CONEC2
                ON CONEC2.NR_PTO_ELET_FIM = CONEC.NR_PTO_ELET_INICIO
         LEFT JOIN VS_PRI_TRAFO_DIST TRAFDIST
                ON TRAFDIST.ID = CONEC2.FEATURE_ID
         LEFT JOIN MV_GENESIS_SUGERE_FASE_BT SUGERE 
              ON SUGERE.FEATURE_ID = RAMAL.ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_RDE_CONEC_LTR" ("ID", "NR_PTO_ELET_INICIO", "NR_PTO_ELET_FIM", "FEATURE_TYPE", "FEATURE_ID", "OBJ_REF_ID", "OLD_FEAT_NUM", "OLD_FEAT_CODE", "OLD_NR_PTO_ELET_INICIO", "OLD_NR_PTO_ELET_FIM", "ID_FLUXO_CONEC", "ID_EST_ATUAL_EQPTO", "ID_EST_BASICO_EQP", "SG_REGIONAL", "ID_OPER")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  WITH PRIMARY KEY USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT 
"RDE_CONEC_LTR"."ID" "ID",
"RDE_CONEC_LTR"."NR_PTO_ELET_INICIO" "NR_PTO_ELET_INICIO",
"RDE_CONEC_LTR"."NR_PTO_ELET_FIM" "NR_PTO_ELET_FIM",
"RDE_CONEC_LTR"."FEATURE_TYPE" "FEATURE_TYPE",
"RDE_CONEC_LTR"."FEATURE_ID" "FEATURE_ID",
"RDE_CONEC_LTR"."OBJ_REF_ID" "OBJ_REF_ID",
"RDE_CONEC_LTR"."OLD_FEAT_NUM" "OLD_FEAT_NUM",
"RDE_CONEC_LTR"."OLD_FEAT_CODE" "OLD_FEAT_CODE",
"RDE_CONEC_LTR"."OLD_NR_PTO_ELET_INICIO" "OLD_NR_PTO_ELET_INICIO",
"RDE_CONEC_LTR"."OLD_NR_PTO_ELET_FIM" "OLD_NR_PTO_ELET_FIM",
"RDE_CONEC_LTR"."ID_FLUXO_CONEC" "ID_FLUXO_CONEC",
"RDE_CONEC_LTR"."ID_EST_ATUAL_EQPTO" "ID_EST_ATUAL_EQPTO",
"RDE_CONEC_LTR"."ID_EST_BASICO_EQP" "ID_EST_BASICO_EQP",
"RDE_CONEC_LTR"."SG_REGIONAL" "SG_REGIONAL",
"RDE_CONEC_LTR"."ID_OPER" "ID_OPER" 
FROM RDE_CONEC_LTR
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SEGCON" ("COD_ID", "DIST", "GEOM_CAB", "FORM_CAB", "BIT_FAS_1", "BIT_FAS_2", "BIT_FAS_3", "BIT_NEU", "MAT_FAS_1", "MAT_FAS_2", "MAT_FAS_3", "MAT_NEU", "ISO_FAS_1", "ISO_FAS_2", "ISO_FAS_3", "ISO_NEU", "CND_FAS", "R1", "X1", "FTRCNV", "CNOM", "CMAX", "CM_FAS", "TUC_FAS", "A1_FAS", "A2_FAS", "A3_FAS", "A4_FAS", "A5_FAS", "A6_FAS", "CM_NEU", "TUC_NEU", "A1_NEU", "A2_NEU", "A3_NEU", "A4_NEU", "A5_NEU", "A6_NEU", "DESCR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT
"COD_ID",
"DIST",
"GEOM_CAB",
"FORM_CAB",
"BIT_FAS_1",
"BIT_FAS_2",
"BIT_FAS_3",
"BIT_NEU",
"MAT_FAS_1",
"MAT_FAS_2",
"MAT_FAS_3",
"MAT_NEU",
"ISO_FAS_1",
"ISO_FAS_2",
"ISO_FAS_3",
"ISO_NEU",
"CND_FAS",
"R1",
"X1",
"FTRCNV",
"CNOM",
"CMAX",
"CM_FAS",
"TUC_FAS",
"A1_FAS",
"A2_FAS",
"A3_FAS",
"A4_FAS",
"A5_FAS",
"A6_FAS",
"CM_NEU",
"TUC_NEU",
"A1_NEU",
"A2_NEU",
"A3_NEU",
"A4_NEU",
"A5_NEU",
"A6_NEU",
"DESCR" FROM V_GENESIS_SEGCON_AT
UNION
SELECT "COD_ID","DIST","GEOM_CAB","FORM_CAB","BIT_FAS_1","BIT_FAS_2","BIT_FAS_3","BIT_NEU","MAT_FAS_1","MAT_FAS_2","MAT_FAS_3","MAT_NEU","ISO_FAS_1","ISO_FAS_2","ISO_FAS_3","ISO_NEU","CND_FAS","R1","X1","FTRCNV","CNOM","CMAX","CM_FAS","TUC_FAS","A1_FAS","A2_FAS","A3_FAS","A4_FAS","A5_FAS","A6_FAS","CM_NEU","TUC_NEU","A1_NEU","A2_NEU","A3_NEU","A4_NEU","A5_NEU","A6_NEU","DESCR" FROM V_GENESIS_SEGCON_MT
UNION
SELECT "COD_ID","DIST","GEOM_CAB","FORM_CAB","BIT_FAS_1","BIT_FAS_2","BIT_FAS_3","BIT_NEU","MAT_FAS_1","MAT_FAS_2","MAT_FAS_3","MAT_NEU","ISO_FAS_1","ISO_FAS_2","ISO_FAS_3","ISO_NEU","CND_FAS","R1","X1","FTRCNV","CNOM","CMAX","CM_FAS","TUC_FAS","A1_FAS","A2_FAS","A3_FAS","A4_FAS","A5_FAS","A6_FAS","CM_NEU","TUC_NEU","A1_NEU","A2_NEU","A3_NEU","A4_NEU","A5_NEU","A6_NEU","DESCR" FROM V_GENESIS_SEGCON_BT
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SEGCON_BT" ("COD_ID", "DIST", "GEOM_CAB", "FORM_CAB", "BIT_FAS_1", "BIT_FAS_2", "BIT_FAS_3", "BIT_NEU", "MAT_FAS_1", "MAT_FAS_2", "MAT_FAS_3", "MAT_NEU", "ISO_FAS_1", "ISO_FAS_2", "ISO_FAS_3", "ISO_NEU", "CND_FAS", "R1", "X1", "FTRCNV", "CNOM", "CMAX", "CM_FAS", "TUC_FAS", "A1_FAS", "A2_FAS", "A3_FAS", "A4_FAS", "A5_FAS", "A6_FAS", "CM_NEU", "TUC_NEU", "A1_NEU", "A2_NEU", "A3_NEU", "A4_NEU", "A5_NEU", "A6_NEU", "DESCR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT DISTINCT 'BT-' || NVL(CABO_A.ID, 0) || '-' || NVL(CABO_B.ID, 0) || '-' || NVL(CABO_C.ID, 0) || '-' || NVL(CABO_NEU.ID, 0) || '-' || DECODE(REGEXP_INSTR(BT.DESCR, 'AEREO'), 0, 5, DECODE(COALESCE(TRH.ID_TIPO_REDE_A, TRH.ID_TIPO_REDE_B, TRH.ID_TIPO_REDE_C, TRH.ID_TIPO_REDE_NEUTRO), 3, 4, 7)) COD_ID,
       '5697' DIST,
       DECODE(REGEXP_INSTR(BT.DESCR, 'Aereo'), 0, 5, DECODE(COALESCE(TRH.ID_TIPO_REDE_A, TRH.ID_TIPO_REDE_B, TRH.ID_TIPO_REDE_C, TRH.ID_TIPO_REDE_NEUTRO), 3, 4, 7)) GEOM_CAB,
       COALESCE(CABO_A.FOR_ID, CABO_B.FOR_ID, CABO_C.FOR_ID) FORM_CAB,
       NVL(CABO_A.BIT_ID, '0')  BIT_FAS_1,
       NVL(CABO_B.BIT_ID, '0') BIT_FAS_2,
       NVL(CABO_C.BIT_ID, '0') BIT_FAS_3,
       DECODE(TRH.TIPO_CABO_NEUTRO_ID, 141, '31', NVL(CABO_NEU.BIT_ID, '0')) BIT_NEU,

       NVL(CABO_A.MAT_ID, '0') MAT_FAS_1,
       NVL(CABO_B.MAT_ID, '0') MAT_FAS_2,
       NVL(CABO_C.MAT_ID, '0') MAT_FAS_3,
       NVL(CABO_NEU.MAT_ID, '0') MAT_NEU,

       NVL(CABO_A.ISO_ID, '0') ISO_FAS_1,
       NVL(CABO_B.ISO_ID, '0') ISO_FAS_2,
       NVL(CABO_C.ISO_ID, '0') ISO_FAS_3,
       NVL(CABO_NEU.ISO_ID, '0') ISO_NEU,

       '1' CND_FAS,
       COALESCE(CABO_A.RS_SEQ_POSIT_CABDT, CABO_B.RS_SEQ_POSIT_CABDT, CABO_C.RS_SEQ_POSIT_CABDT, CABO_NEU.RS_SEQ_POSIT_CABDT) R1,
       COALESCE(CABO_A.RX_SEQ_POSIT_CABDT, CABO_B.RX_SEQ_POSIT_CABDT, CABO_C.RX_SEQ_POSIT_CABDT, CABO_NEU.RX_SEQ_POSIT_CABDT) X1,
       --DECODE(COALESCE(CABO_A.ID_TIPO_ISOLAMENTO, CABO_B.ID_TIPO_ISOLAMENTO, CABO_C.ID_TIPO_ISOLAMENTO, CABO_NEU.ID_TIPO_ISOLAMENTO), 1, TRUNC(COALESCE(CABO_A.PS_CABO_DISTR, CABO_B.PS_CABO_DISTR, CABO_C.PS_CABO_DISTR, CABO_NEU.PS_CABO_DISTR)/1000,3), NULL) FTRCNV,
       COALESCE(CABO_A.FATOR_CONVERSAO, CABO_B.FATOR_CONVERSAO, CABO_C.FATOR_CONVERSAO, CABO_NEU.FATOR_CONVERSAO) FTRCNV,
       COALESCE(CABO_A.CR_NOMINAL_CABDT, CABO_B.CR_NOMINAL_CABDT, CABO_C.CR_NOMINAL_CABDT, CABO_NEU.CR_NOMINAL_CABDT) CNOM,
       COALESCE(CABO_A.CR_MAX_CABDT, CABO_B.CR_MAX_CABDT, CABO_C.CR_MAX_CABDT, CABO_NEU.CR_MAX_CABDT) CMAX,
       '000' CM_FAS,
       '190' TUC_FAS,
       DECODE(COALESCE(CABO_A.ID, CABO_B.ID, CABO_C.ID), NULL, '00', '0' || COALESCE(CABO_A.ID_TIPO_BEM, CABO_B.ID_TIPO_BEM, CABO_C.ID_TIPO_BEM)) A1_FAS,
       DECODE(LENGTH(COALESCE(CABO_A.ID_TIPO_MATERIAL, CABO_B.ID_TIPO_MATERIAL, CABO_C.ID_TIPO_MATERIAL)), NULL, '00', 1, '0' || COALESCE(CABO_A.ID_TIPO_MATERIAL, CABO_B.ID_TIPO_MATERIAL, CABO_C.ID_TIPO_MATERIAL), COALESCE(CABO_A.ID_TIPO_MATERIAL, CABO_B.ID_TIPO_MATERIAL, CABO_C.ID_TIPO_MATERIAL)) A2_FAS,
       DECODE(LENGTH(COALESCE(CABO_A.ID_TIPO_ISOLAMENTO, CABO_B.ID_TIPO_ISOLAMENTO, CABO_C.ID_TIPO_ISOLAMENTO)), NULL, '00', 1, '0' || COALESCE(CABO_A.ID_TIPO_ISOLAMENTO, CABO_B.ID_TIPO_ISOLAMENTO, CABO_C.ID_TIPO_ISOLAMENTO), COALESCE(CABO_A.ID_TIPO_ISOLAMENTO, CABO_B.ID_TIPO_ISOLAMENTO, CABO_C.ID_TIPO_ISOLAMENTO)) A3_FAS,
       DECODE(LENGTH(COALESCE(CABO_A.ID_BITOLA, CABO_B.ID_BITOLA, CABO_C.ID_BITOLA)), NULL, '00', 1, '0' || COALESCE(CABO_A.ID_BITOLA, CABO_B.ID_BITOLA, CABO_C.ID_BITOLA), COALESCE(CABO_A.ID_BITOLA, CABO_B.ID_BITOLA, CABO_C.ID_BITOLA)) A4_FAS,
       DECODE(LENGTH(COALESCE(CABO_A.ID_NUM_FASES, CABO_B.ID_NUM_FASES, CABO_C.ID_NUM_FASES)), NULL, '00', 1, '0' || COALESCE(CABO_A.ID_NUM_FASES, CABO_B.ID_NUM_FASES, CABO_C.ID_NUM_FASES), COALESCE(CABO_A.ID_NUM_FASES, CABO_B.ID_NUM_FASES, CABO_C.ID_NUM_FASES)) A5_FAS,
       '00' A6_FAS,

       '000' CM_NEU,
       '190' TUC_NEU,

       DECODE(CABO_NEU.ID, NULL, '00', '0' || CABO_NEU.ID_TIPO_BEM) A1_NEU,
       DECODE(LENGTH(CABO_NEU.ID_TIPO_MATERIAL), NULL, '00', 1, '0' || CABO_NEU.ID_TIPO_MATERIAL, CABO_NEU.ID_TIPO_MATERIAL) A2_NEU,
       DECODE(LENGTH(CABO_NEU.ID_TIPO_ISOLAMENTO), NULL, '00', 1, '0' || CABO_NEU.ID_TIPO_ISOLAMENTO, CABO_NEU.ID_TIPO_ISOLAMENTO) A3_NEU,
       DECODE(LENGTH(CABO_NEU.ID_BITOLA), NULL, '00', 1, '0' || CABO_NEU.ID_BITOLA, CABO_NEU.ID_BITOLA) A4_NEU,
       DECODE(LENGTH(CABO_NEU.ID_NUM_FASES), NULL, '00', 1, '0' || CABO_NEU.ID_NUM_FASES, CABO_NEU.ID_NUM_FASES) A5_NEU,
       '00' A6_NEU,


       NVL(TRUNC(CABO_A.PS_CABO_DISTR/1000,4),0) || '; '|| NVL(TRUNC(CABO_B.PS_CABO_DISTR/1000,4),0) || '; '|| NVL(TRUNC(CABO_C.PS_CABO_DISTR/1000,4),0) || '; '|| NVL(TRUNC(CABO_NEU.PS_CABO_DISTR/1000,4),0) DESCR

FROM  V_BDGD_SSDBT BT
      LEFT JOIN PRI_TRECHO_SECDR TRH
           ON TRH.ID = SUBSTR(BT.DESCR, REGEXP_INSTR(BT.DESCR, ',', 1, 1)+2,  ((REGEXP_INSTR(BT.DESCR, ',', 1, 2)-1)-(REGEXP_INSTR(BT.DESCR, ',', 1, 1)+1)))
      LEFT JOIN V_CABOS_BDGD_GEN_MT_BT_FULL CABO_A
           ON TRH.TIPO_CABO_A_ID = CABO_A.ID
      LEFT JOIN V_CABOS_BDGD_GEN_MT_BT_FULL CABO_B
           ON TRH.TIPO_CABO_B_ID = CABO_B.ID
      LEFT JOIN V_CABOS_BDGD_GEN_MT_BT_FULL CABO_C
           ON TRH.TIPO_CABO_C_ID = CABO_C.ID
      LEFT JOIN V_CABOS_BDGD_GEN_MT_BT_FULL CABO_NEU
           ON COALESCE(TRH.TIPO_CABO_NEUTRO_ID, TRH.TIPO_CABO_A_ID, TRH.TIPO_CABO_B_ID, TRH.TIPO_CABO_C_ID) = CABO_NEU.ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SEGCON_MT" ("COD_ID", "DIST", "ID_TIPO_REDE", "TRECHO_ID", "1", "3", "6", "7", "4", "GEOM_CAB", "FORM_CAB", "BIT_FAS_1", "BIT_FAS_2", "BIT_FAS_3", "BIT_NEU", "MAT_FAS_1", "MAT_FAS_2", "MAT_FAS_3", "MAT_NEU", "ISO_FAS_1", "ISO_FAS_2", "ISO_FAS_3", "ISO_NEU", "CND_FAS", "R1", "X1", "FTRCNV", "CNOM", "CMAX", "CM_FAS", "TUC_FAS", "A1_FAS", "A2_FAS", "A3_FAS", "A4_FAS", "A5_FAS", "A6_FAS", "CM_NEU", "TUC_NEU", "A1_NEU", "A2_NEU", "A3_NEU", "A4_NEU", "A5_NEU", "A6_NEU", "DESCR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE USING NO INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select * from V_BDGD_SEGCON_MT
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SSDAT" ("COD_ID", "PN_CON_1", "PN_CON_2", "CONJ", "ARE_LOC", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_CND", "POS", "ODI_FAS", "TI_FAS", "SITCONTFAS", "ODI_NEU", "TI_NEU", "SITCONTNEU", "COMP", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT A.ID COD_ID,
FIX_PN_1.FEATURE_ID PN_CON_1,
FIX_PN_2.FEATURE_ID PN_CON_2,
NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
DECODE(B.ID_AREA_OBJETO,
'U', 'UB',
'R', 'NU') ARE_LOC,
'5697' DIST,
RDE.NR_PTO_ELET_INICIO PAC_1,
RDE.NR_PTO_ELET_FIM PAC_2,
'ABC' FAS_CON,
'AT-' || TAB.ID_CABO_CONDUTOR TIP_CND,
'PD' POS,
TO_CHAR(TAB_LINHA.NR_CENTRO_CUSTO) ODI_FAS,
DECODE(B.TN_NOM_LTR, 69, DECODE(B.ID_AREA_OBJETO, 'U', 37, 'R', 57), 138, DECODE(B.ID_AREA_OBJETO, 'U', 38, 'R', 58), -1) TI_FAS,
'AT1' SITCONTFAS,
'0' ODI_NEU,
'00' TI_NEU,
'0' SITCONTNEU,
A.LENGTH COMP,
'AT, ' || TAB.ID_CABO_CONDUTOR || ', ' || B.TN_NOM_LTR || ', ' || TAB_LINHA.TN_NOM_LTR || ', ' || TAB.NR_LOCALINST_GEN || ', ' || TAB.NR_LOCALINST_SAP || ', '|| B.OLD_FEAT_NUM || ', '|| B.ID DESCR,
A.GEOMETRY
FROM PRI_VAO_LTR_F A
LEFT JOIN PRI_VAO_LTR B ON A.PRI_VAO_LTR_ID = B.ID
LEFT JOIN CR_ACC_POINT_LINK FIX ON A.ID = FIX.FEATURE_ID
LEFT JOIN CR_ACC_POINT FIX_PN_1 ON FIX.ID_CR_ACC_POINT_1 = FIX_PN_1.ID
LEFT JOIN CR_ACC_POINT FIX_PN_2 ON FIX.ID_CR_ACC_POINT_2 = FIX_PN_2.ID
--LEFT JOIN VA_MUNICIPIO_ANEEL MUN
--     ON B.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ ON B.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
LEFT JOIN RDE_CONEC_LTR RDE ON RDE.FEATURE_ID = A.ID
LEFT JOIN TAB_SAP_VAO_TRMSS TAB ON TAB.NR_LOCALINST_GEN = B.NR_LOCALINST_GEN
LEFT JOIN TAB_SAP_LINHA_TRMSS TAB_LINHA ON TAB_LINHA.NR_LOCALINST_GEN = TAB.NR_LOCALINST_GEN_SUP
WHERE A.ID NOT IN (9780665, 11926821, 11926828, 11928110) --TRECHO QUE NAO EXISTE"
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SSDBT" ("COD_ID", "PN_CON_1", "PN_CON_2", "UNI_TR_D", "CTMT", "SUB", "CONJ", "ARE_LOC", "FAS_CON", "DIST", "PAC_1", "PAC_2", "TIP_CND", "POS", "ODI_FAS", "TI_FAS", "SITCONTFAS", "ODI_NEU", "TI_NEU", "SITCONTNEU", "COMP", "DESCR", "GEOMETRY", "ID", "OLD_FEAT_NUM", "OLD_FEAT_CODE", "ID_FASE_TRECHO_CSE", "TIPO_CABO_A_ID", "OLD_CD_CABO_FASE_A_CSE", "ID_TIPO_REDE_A", "TIPO_CABO_B_ID", "OLD_CD_CABO_FASE_B_CSE", "ID_TIPO_REDE_B", "TIPO_CABO_C_ID", "OLD_CD_CABO_FASE_C_CSE", "ID_TIPO_REDE_C", "TIPO_CABO_NEUTRO_ID", "OLD_CD_CABO_NEUTRO_CSE", "ID_TIPO_REDE_NEUTRO", "QT_ESPCD_VAO_CSE", "OLD_FEAT_NUM_TD", "CR_PASSANTE_FASEA", "CR_PASSANTE_FASEB", "CR_PASSANTE_FASEC", "CR_PASSANTE_NEUTRO", "TN_FIM_TRSEC_FASEA", "TN_FIM_TRSEC_FASEB", "TN_FIM_TRSEC_FASEC", "IN_CARGM_TRSEC_REF", "CR_PASSANTE_A_REF", "CR_PASSANTE_B_REF", "CR_PASSANTE_C_REF", "TN_FIM_FASEA_REF", "TN_FIM_FASEB_REF", "TN_FIM_FASEC_REF", "OLD_NR_CIRCUITO", "ID_CIRCUITO", "ID_PRPR_TRECHO_CSE", "PRI_TRAFO_DIST_ID", "EX_TRECHO_SECDR", "ID_AREA_OBJETO", "PRI_MUNICIPIO_ID", "AREA_REGL_RSPDD_ID", "PRI_CONJUNTO_CNS_ID", "ID_CONNECTED", "ID_ENERGIZED", "IN_CARGM_FASE_A",
"IN_CARGM_FASE_B", "IN_CARGM_FASE_C", "IN_CARGM_FASE_NEUTRO", "IN_QUEDA_TN_FASEA", "IN_QUEDA_TN_FASEB", "IN_QUEDA_TN_FASEC", "IN_PERDA_ATIV_FASEA", "IN_PERDA_ATIV_FASEB", "IN_PERDA_ATIV_FASEC", "IN_PERDA_REAT_FASEA", "IN_PERDA_REAT_FASEB", "IN_PERDA_REAT_FASEC", "IN_APPARENT_POWER_PHASE_A", "IN_APPARENT_POWER_PHASE_B", "IN_APPARENT_POWER_PHASE_C", "IN_ACTIVE_POWER_PHASE_A", "IN_ACTIVE_POWER_PHASE_B", "IN_ACTIVE_POWER_PHASE_C")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT A.ID COD_ID,
FIX_PN_1.FEATURE_ID PN_CON_1,
FIX_PN_2.FEATURE_ID PN_CON_2,
NVL(TFD_F.ID, 0) UNI_TR_D,
NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
--0 UNI_TR_S,
NVL(SUB.SG_SUBESTACAO, 0) SUB,
NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
DECODE(B.ID_AREA_OBJETO,
'U', 'UB',
'R', 'NU') ARE_LOC,
DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 2, 'BN', 4, 'ABN', 8,'N',10, 'N', '-1'),
                              2, DECODE(B.ID_FASE_TRECHO_CSE, 1,'BN', 2, 'CN', 4, 'BCN', 8,'N',10, 'N', '-2'),
                              3, DECODE(B.ID_FASE_TRECHO_CSE, 1,'CN', 2, 'AN', 4, 'CAN', 8,'N',10, 'N', '-3'),
                              4, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 2, 'BN', 4, 'ABN', 8,'N',10, 'N', '-4'),
                              5, DECODE(B.ID_FASE_TRECHO_CSE, 1,'CN', 2, 'AN', 4, 'CAN', 8,'N',10, 'N', '-5'),
                              6, DECODE(B.ID_FASE_TRECHO_CSE, 1,'BN', 2, 'CN', 4, 'BCN', 8,'N',10, 'N', '-6'),
                              7, DECODE(B.ID_FASE_TRECHO_CSE,1,'AN',2, 'BN',3, 'CN',4, 'ABN',5, 'CAN',6, 'BCN',7, 'ABCN',8, 'N',10, 'N','-7'),
                              DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN',2, 'BN',3, 'CN',4, 'ABN',5, 'CAN',6, 'BCN',7, 'ABCN', 8,'N',10, 'N', '-8')) FAS_CON,
/*DECODE(B.ID_FASE_TRECHO_CSE, 1, 'AN',
2, 'BN',
3, 'CN',
4, 'ABN',
5, 'CAN',
6, 'BCN',
7, 'ABCN',
8, 'N',
10, 'N',
'-1') FAS_CON,*/
'5697' DIST,
COALESCE(BY_PASS_CMDO.NR_PTO_ELET_INICIO, NVL2(RDE.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO, 0)) PAC_1,
--NVL2(RDE.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO, 0) PAC_1,
NVL2(RDE.NR_PTO_ELET_FIM, RDE.NR_PTO_ELET_FIM, 0) PAC_2,
--'BT-' || NVL(B.TIPO_CABO_A_ID, 0) || '-' || NVL(B.TIPO_CABO_B_ID, 0) || '-' || NVL(B.TIPO_CABO_C_ID, 0) || '-' || NVL(B.TIPO_CABO_NEUTRO_ID, 0) || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'AEREO'), 0, 5, DECODE(COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO), 3, 4, 7))  TIP_CND,
'BT-' || CASE WHEN B.ID_FASE_TRECHO_CSE IN (1,4,5,7) THEN TO_CHAR(B.TIPO_CABO_A_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (2,6) THEN TO_CHAR(B.TIPO_CABO_B_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (3) THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0'
END || '-' || CASE WHEN B.ID_FASE_TRECHO_CSE IN (4,7) THEN TO_CHAR(B.TIPO_CABO_B_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (5,6) THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0'
END || '-' || CASE WHEN B.ID_FASE_TRECHO_CSE = 7 THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0' --VVV PRECISOU MUDAR POR CAUSA DO NEUTRO
END || '-' || NVL(COALESCE(B.TIPO_CABO_NEUTRO_ID, B.TIPO_CABO_A_ID, B.TIPO_CABO_B_ID, B.TIPO_CABO_C_ID), 0) || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'Aereo'), 0, 5, DECODE(COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO), 3, 4, 7)) TIP_CND,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'PD',
2, 'CS',
'-1') POS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '0',
DECODE(B.ID_PRPR_TRECHO_CSE, 1, '190400',
2, '0',
'-1')) ODI_FAS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '00',
DECODE(B.ID_PRPR_TRECHO_CSE, 2, '00',
DECODE(A.FEATURE_TYPE, 'TrechoSecundarioSubterraneo', DECODE(B.ID_AREA_OBJETO, 'U', '42',
'R', '43'),
'TrechoSecundarioAereo', DECODE(B.ID_AREA_OBJETO, 'U', '40',
'R', '41'),
'-1')
)) TI_FAS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '0',
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'AT1',
2, '0')) SITCONTFAS,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, '190400',
2, '0') ODI_NEU,
DECODE(B.ID_PRPR_TRECHO_CSE, 2, '00',
DECODE(A.FEATURE_TYPE, 'TrechoSecundarioSubterraneo', DECODE(B.ID_AREA_OBJETO, 'U', '42',
'R', '43'),
'TrechoSecundarioAereo', DECODE(B.ID_AREA_OBJETO, 'U', '40',
'R', '41'),
'-1')
) TI_NEU,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'AT1',
2, '0') SITCONTNEU,
A.LENGTH COMP,
'BT, ' || B.ID || ', ' || A.FEATURE_TYPE || ', '|| COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO) || ', '|| B.ID_PRPR_TRECHO_CSE || ', '|| B.OLD_FEAT_NUM || ', '|| B.OLD_FEAT_CODE || ', '|| B.ID_FASE_TRECHO_CSE || ', '|| A.TEXT || ', '|| B.OLD_CD_CABO_FASE_A_CSE || ', '|| B.OLD_CD_CABO_FASE_B_CSE || ', '|| B.OLD_CD_CABO_FASE_C_CSE || ', '|| B.OLD_CD_CABO_NEUTRO_CSE DESCR,
A.GEOMETRY,
B."ID",B."OLD_FEAT_NUM",B."OLD_FEAT_CODE",B."ID_FASE_TRECHO_CSE",B."TIPO_CABO_A_ID",B."OLD_CD_CABO_FASE_A_CSE",B."ID_TIPO_REDE_A",B."TIPO_CABO_B_ID",B."OLD_CD_CABO_FASE_B_CSE",B."ID_TIPO_REDE_B",B."TIPO_CABO_C_ID",B."OLD_CD_CABO_FASE_C_CSE",B."ID_TIPO_REDE_C",B."TIPO_CABO_NEUTRO_ID",B."OLD_CD_CABO_NEUTRO_CSE",B."ID_TIPO_REDE_NEUTRO",B."QT_ESPCD_VAO_CSE",B."OLD_FEAT_NUM_TD",B."CR_PASSANTE_FASEA",B."CR_PASSANTE_FASEB",B."CR_PASSANTE_FASEC",B."CR_PASSANTE_NEUTRO",B."TN_FIM_TRSEC_FASEA",B."TN_FIM_TRSEC_FASEB",B."TN_FIM_TRSEC_FASEC",B."IN_CARGM_TRSEC_REF",B."CR_PASSANTE_A_REF",B."CR_PASSANTE_B_REF",B."CR_PASSANTE_C_REF",B."TN_FIM_FASEA_REF",B."TN_FIM_FASEB_REF",B."TN_FIM_FASEC_REF",B."OLD_NR_CIRCUITO",B."ID_CIRCUITO",B."ID_PRPR_TRECHO_CSE",B."PRI_TRAFO_DIST_ID",B."EX_TRECHO_SECDR",B."ID_AREA_OBJETO",B."PRI_MUNICIPIO_ID",B."AREA_REGL_RSPDD_ID",B."PRI_CONJUNTO_CNS_ID",B."ID_CONNECTED",B."ID_ENERGIZED",B."IN_CARGM_FASE_A",B."IN_CARGM_FASE_B",B."IN_CARGM_FASE_C",B."IN_CARGM_FASE_NEUTRO",B."IN_QUEDA_TN_FASEA",B."IN_QUEDA_TN_FASEB",B."IN_QUEDA_TN_FASEC",B."IN_PERDA_ATIV_FASEA",B."IN_PERDA_ATIV_FASEB",B."IN_PERDA_ATIV_FASEC",B."IN_PERDA_REAT_FASEA",B."IN_PERDA_REAT_FASEB",B."IN_PERDA_REAT
_FASEC",B."IN_APPARENT_POWER_PHASE_A",B."IN_APPARENT_POWER_PHASE_B",B."IN_APPARENT_POWER_PHASE_C",B."IN_ACTIVE_POWER_PHASE_A",B."IN_ACTIVE_POWER_PHASE_B",B."IN_ACTIVE_POWER_PHASE_C"
FROM PRI_TRECHO_SECDR_F A
LEFT JOIN PRI_TRECHO_SECDR B ON A.PRI_TRECHO_SECDR_ID = B.ID
LEFT JOIN CR_ACC_POINT_LINK FIX ON A.ID = FIX.FEATURE_ID
LEFT JOIN CR_ACC_POINT FIX_PN_1 ON FIX.ID_CR_ACC_POINT_1 = FIX_PN_1.ID
LEFT JOIN CR_ACC_POINT FIX_PN_2 ON FIX.ID_CR_ACC_POINT_2 = FIX_PN_2.ID
--LEFT JOIN VA_MUNICIPIO_ANEEL MUN
--ON B.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ ON B.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
LEFT JOIN RDE_CONEC_CSE RDE ON RDE.FEATURE_ID = A.ID
LEFT JOIN PRI_TRAFO_DIST TFD ON TFD.ID = B.PRI_TRAFO_DIST_ID
LEFT JOIN PRI_TRAFO_DIST_F TFD_F ON TFD.ID = TFD_F.PRI_TRAFO_DIST_ID
LEFT JOIN PRI_ALIMENTADOR ALI ON TFD.PRI_ALIMENTADOR_ID = ALI.ID
LEFT JOIN PRI_SUBESTACAO SUB ON ALI.PRI_SUBESTACAO_ID = SUB.ID
LEFT JOIN BDGD.VAUX_BY_PASS_COMANDO_IP BY_PASS_CMDO ON BY_PASS_CMDO.NR_PTO_ELET_FIM = RDE.NR_PTO_ELET_INICIO
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SSDBT_2" ("COD_ID", "PN_CON_1", "PN_CON_2", "UNI_TR_D", "CTMT", "SUB", "CONJ", "ARE_LOC", "ID_FASE_LIGADA_TD", "FAS_CON_2", "FAS_CON", "DIST", "PAC_1", "PAC_2", "TIP_CND", "POS", "ODI_FAS", "TI_FAS", "SITCONTFAS", "ODI_NEU", "TI_NEU", "SITCONTNEU", "COMP", "DESCR", "GEOMETRY", "ID", "OLD_FEAT_NUM", "OLD_FEAT_CODE", "ID_FASE_TRECHO_CSE", "TIPO_CABO_A_ID", "OLD_CD_CABO_FASE_A_CSE", "ID_TIPO_REDE_A", "TIPO_CABO_B_ID", "OLD_CD_CABO_FASE_B_CSE", "ID_TIPO_REDE_B", "TIPO_CABO_C_ID", "OLD_CD_CABO_FASE_C_CSE", "ID_TIPO_REDE_C", "TIPO_CABO_NEUTRO_ID", "OLD_CD_CABO_NEUTRO_CSE", "ID_TIPO_REDE_NEUTRO", "QT_ESPCD_VAO_CSE", "OLD_FEAT_NUM_TD", "CR_PASSANTE_FASEA", "CR_PASSANTE_FASEB", "CR_PASSANTE_FASEC", "CR_PASSANTE_NEUTRO", "TN_FIM_TRSEC_FASEA", "TN_FIM_TRSEC_FASEB", "TN_FIM_TRSEC_FASEC", "IN_CARGM_TRSEC_REF", "CR_PASSANTE_A_REF", "CR_PASSANTE_B_REF", "CR_PASSANTE_C_REF", "TN_FIM_FASEA_REF", "TN_FIM_FASEB_REF", "TN_FIM_FASEC_REF", "OLD_NR_CIRCUITO", "ID_CIRCUITO", "ID_PRPR_TRECHO_CSE", "PRI_TRAFO_DIST_ID", "EX_TRECHO_SECDR", "ID_AREA_OBJETO", "PRI_MUNICIPIO_ID", "AREA_REGL_RSPDD_ID", "PRI_CONJUNTO_CNS_ID", "ID_CONNECTED", "ID_ENERGIZED",
"IN_CARGM_FASE_A", "IN_CARGM_FASE_B", "IN_CARGM_FASE_C", "IN_CARGM_FASE_NEUTRO", "IN_QUEDA_TN_FASEA", "IN_QUEDA_TN_FASEB", "IN_QUEDA_TN_FASEC", "IN_PERDA_ATIV_FASEA", "IN_PERDA_ATIV_FASEB", "IN_PERDA_ATIV_FASEC", "IN_PERDA_REAT_FASEA", "IN_PERDA_REAT_FASEB", "IN_PERDA_REAT_FASEC", "IN_APPARENT_POWER_PHASE_A", "IN_APPARENT_POWER_PHASE_B", "IN_APPARENT_POWER_PHASE_C", "IN_ACTIVE_POWER_PHASE_A", "IN_ACTIVE_POWER_PHASE_B", "IN_ACTIVE_POWER_PHASE_C")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT A.ID COD_ID,
FIX_PN_1.FEATURE_ID PN_CON_1,
FIX_PN_2.FEATURE_ID PN_CON_2,
NVL(TFD_F.ID, 0) UNI_TR_D,
NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
--0 UNI_TR_S,
NVL(SUB.SG_SUBESTACAO, 0) SUB,
NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
DECODE(B.ID_AREA_OBJETO,
'U', 'UB',
'R', 'NU') ARE_LOC,
tfd.id_fase_ligada_td,
DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 2, 'BN', 4, 'ABN', 8,'N',10, 'N', '-1'),
                              2, DECODE(B.ID_FASE_TRECHO_CSE, 1,'BN', 2, 'CN', 4, 'BCN', 8,'N',10, 'N', '-2'),
                              3, DECODE(b.ID_FASE_TRECHO_CSE, 1,'CN', 2, 'AN', 4, 'CAN', 8,'N',10, 'N', '-3'),
                              4, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 2, 'BN', 4, 'ABN', 8,'N',10, 'N', '-4'),
                              5, DECODE(B.ID_FASE_TRECHO_CSE, 1,'BN', 2, 'CN', 4, 'BCN', 8,'N',10, 'N', '-5'),
                              6, DECODE(b.ID_FASE_TRECHO_CSE, 1,'CN', 2, 'AN', 4, 'CAN', 8,'N',10, 'N', '-6'),
                              7, DECODE(B.ID_FASE_TRECHO_CSE,1,'AN',2, 'BN',3, 'CN',4, 'ABN',5, 'CAN',6, 'BCN',7, 'ABCN',8, 'N',10, 'N','-7'), '-8') fas_con_2,

DECODE(B.ID_FASE_TRECHO_CSE,1,'AN',2, 'BN',3, 'CN',4, 'ABN',5, 'CAN',6, 'BCN',7, 'ABCN',8, 'N',10, 'N','-1') FAS_CON,
'5697' DIST,
COALESCE(BY_PASS_CMDO.NR_PTO_ELET_INICIO, NVL2(RDE.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO, 0)) PAC_1,
--NVL2(RDE.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO, 0) PAC_1,
NVL2(RDE.NR_PTO_ELET_FIM, RDE.NR_PTO_ELET_FIM, 0) PAC_2,
--'BT-' || NVL(B.TIPO_CABO_A_ID, 0) || '-' || NVL(B.TIPO_CABO_B_ID, 0) || '-' || NVL(B.TIPO_CABO_C_ID, 0) || '-' || NVL(B.TIPO_CABO_NEUTRO_ID, 0) || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'AEREO'), 0, 5, DECODE(COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO), 3, 4, 7))  TIP_CND,
'BT-' || CASE WHEN B.ID_FASE_TRECHO_CSE IN (1,4,5,7) THEN TO_CHAR(B.TIPO_CABO_A_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (2,6) THEN TO_CHAR(B.TIPO_CABO_B_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (3) THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0'
END || '-' || CASE WHEN B.ID_FASE_TRECHO_CSE IN (4,7) THEN TO_CHAR(B.TIPO_CABO_B_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (5,6) THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0'
END || '-' || CASE WHEN B.ID_FASE_TRECHO_CSE = 7 THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0' --VVV PRECISOU MUDAR POR CAUSA DO NEUTRO
END || '-' || NVL(COALESCE(B.TIPO_CABO_NEUTRO_ID, B.TIPO_CABO_A_ID, B.TIPO_CABO_B_ID, B.TIPO_CABO_C_ID), 0) || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'Aereo'), 0, 5, DECODE(COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO), 3, 4, 7)) TIP_CND,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'PD',
2, 'CS',
'-1') POS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '0',
DECODE(B.ID_PRPR_TRECHO_CSE, 1, '190400',
2, '0',
'-1')) ODI_FAS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '00',
DECODE(B.ID_PRPR_TRECHO_CSE, 2, '00',
DECODE(A.FEATURE_TYPE, 'TrechoSecundarioSubterraneo', DECODE(B.ID_AREA_OBJETO, 'U', '42',
'R', '43'),
'TrechoSecundarioAereo', DECODE(B.ID_AREA_OBJETO, 'U', '40',
'R', '41'),
'-1')
)) TI_FAS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '0',
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'AT1',
2, '0')) SITCONTFAS,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, '190400',
2, '0') ODI_NEU,
DECODE(B.ID_PRPR_TRECHO_CSE, 2, '00',
DECODE(A.FEATURE_TYPE, 'TrechoSecundarioSubterraneo', DECODE(B.ID_AREA_OBJETO, 'U', '42',
'R', '43'),
'TrechoSecundarioAereo', DECODE(B.ID_AREA_OBJETO, 'U', '40',
'R', '41'),
'-1')
) TI_NEU,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'AT1',
2, '0') SITCONTNEU,
A.LENGTH COMP,
'BT, ' || B.ID || ', ' || A.FEATURE_TYPE || ', '|| COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO) || ', '|| B.ID_PRPR_TRECHO_CSE || ', '|| B.OLD_FEAT_NUM || ', '|| B.OLD_FEAT_CODE || ', '|| B.ID_FASE_TRECHO_CSE || ', '|| A.TEXT || ', '|| B.OLD_CD_CABO_FASE_A_CSE || ', '|| B.OLD_CD_CABO_FASE_B_CSE || ', '|| B.OLD_CD_CABO_FASE_C_CSE || ', '|| B.OLD_CD_CABO_NEUTRO_CSE DESCR,
A.GEOMETRY,
B."ID",B."OLD_FEAT_NUM",B."OLD_FEAT_CODE",B."ID_FASE_TRECHO_CSE",B."TIPO_CABO_A_ID",B."OLD_CD_CABO_FASE_A_CSE",B."ID_TIPO_REDE_A",B."TIPO_CABO_B_ID",B."OLD_CD_CABO_FASE_B_CSE",B."ID_TIPO_REDE_B",B."TIPO_CABO_C_ID",B."OLD_CD_CABO_FASE_C_CSE",B."ID_TIPO_REDE_C",B."TIPO_CABO_NEUTRO_ID",B."OLD_CD_CABO_NEUTRO_CSE",B."ID_TIPO_REDE_NEUTRO",B."QT_ESPCD_VAO_CSE",B."OLD_FEAT_NUM_TD",B."CR_PASSANTE_FASEA",B."CR_PASSANTE_FASEB",B."CR_PASSANTE_FASEC",B."CR_PASSANTE_NEUTRO",B."TN_FIM_TRSEC_FASEA",B."TN_FIM_TRSEC_FASEB",B."TN_FIM_TRSEC_FASEC",B."IN_CARGM_TRSEC_REF",B."CR_PASSANTE_A_REF",B."CR_PASSANTE_B_REF",B."CR_PASSANTE_C_REF",B."TN_FIM_FASEA_REF",B."TN_FIM_FASEB_REF",B."TN_FIM_FASEC_REF",B."OLD_NR_CIRCUITO",B."ID_CIRCUITO",B."ID_PRPR_TRECHO_CSE",B."PRI_TRAFO_DIST_ID",B."EX_TRECHO_SECDR",B."ID_AREA_OBJETO",B."PRI_MUNICIPIO_ID",B."AREA_REGL_RSPDD_ID",B."PRI_CONJUNTO_CNS_ID",B."ID_CONNECTED",B."ID_ENERGIZED",B."IN_CARGM_FASE_A",B."IN_CARGM_FASE_B",B."IN_CARGM_FASE_C",B."IN_CARGM_FASE_NEUTRO",B."IN_QUEDA_TN_FASEA",B."IN_QUEDA_TN_FASEB",B."IN_QUEDA_TN_FASEC",B."IN_PERDA_ATIV_FASEA",B."IN_PERDA_ATIV_FASEB",B."IN_PERDA_ATIV_FASEC",B."IN_PERDA_REAT_FASEA",B."IN_PERDA_REAT_FASEB",B."IN_PERDA_REAT
_FASEC",B."IN_APPARENT_POWER_PHASE_A",B."IN_APPARENT_POWER_PHASE_B",B."IN_APPARENT_POWER_PHASE_C",B."IN_ACTIVE_POWER_PHASE_A",B."IN_ACTIVE_POWER_PHASE_B",B."IN_ACTIVE_POWER_PHASE_C"
FROM PRI_TRECHO_SECDR_F A
LEFT JOIN PRI_TRECHO_SECDR B
ON A.PRI_TRECHO_SECDR_ID = B.ID
LEFT JOIN CR_ACC_POINT_LINK FIX
ON A.ID = FIX.FEATURE_ID
LEFT JOIN CR_ACC_POINT FIX_PN_1
ON FIX.ID_CR_ACC_POINT_1 = FIX_PN_1.ID
LEFT JOIN CR_ACC_POINT FIX_PN_2
ON FIX.ID_CR_ACC_POINT_2 = FIX_PN_2.ID
--LEFT JOIN VA_MUNICIPIO_ANEEL MUN
--ON B.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ
ON B.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
LEFT JOIN RDE_CONEC_CSE RDE
ON RDE.FEATURE_ID = A.ID
LEFT JOIN PRI_TRAFO_DIST TFD
ON TFD.ID = B.PRI_TRAFO_DIST_ID
LEFT JOIN PRI_TRAFO_DIST_F TFD_F
ON TFD.ID = TFD_F.PRI_TRAFO_DIST_ID
LEFT JOIN PRI_ALIMENTADOR ALI
ON TFD.PRI_ALIMENTADOR_ID = ALI.ID
LEFT JOIN PRI_SUBESTACAO SUB
ON ALI.PRI_SUBESTACAO_ID = SUB.ID
LEFT JOIN BDGD.VAUX_BY_PASS_COMANDO_IP BY_PASS_CMDO
          ON BY_PASS_CMDO.NR_PTO_ELET_FIM = RDE.NR_PTO_ELET_INICIO
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SSDBT_3" ("COD_ID", "PN_CON_1", "PN_CON_2", "UNI_TR_D", "CTMT", "SUB", "CONJ", "ARE_LOC", "FAS_CON", "DIST", "PAC_1", "PAC_2", "TIP_CND", "POS", "ODI_FAS", "TI_FAS", "SITCONTFAS", "ODI_NEU", "TI_NEU", "SITCONTNEU", "COMP", "DESCR", "GEOMETRY", "ID", "OLD_FEAT_NUM", "OLD_FEAT_CODE", "ID_FASE_TRECHO_CSE", "TIPO_CABO_A_ID", "OLD_CD_CABO_FASE_A_CSE", "ID_TIPO_REDE_A", "TIPO_CABO_B_ID", "OLD_CD_CABO_FASE_B_CSE", "ID_TIPO_REDE_B", "TIPO_CABO_C_ID", "OLD_CD_CABO_FASE_C_CSE", "ID_TIPO_REDE_C", "TIPO_CABO_NEUTRO_ID", "OLD_CD_CABO_NEUTRO_CSE", "ID_TIPO_REDE_NEUTRO", "QT_ESPCD_VAO_CSE", "OLD_FEAT_NUM_TD", "CR_PASSANTE_FASEA", "CR_PASSANTE_FASEB", "CR_PASSANTE_FASEC", "CR_PASSANTE_NEUTRO", "TN_FIM_TRSEC_FASEA", "TN_FIM_TRSEC_FASEB", "TN_FIM_TRSEC_FASEC", "IN_CARGM_TRSEC_REF", "CR_PASSANTE_A_REF", "CR_PASSANTE_B_REF", "CR_PASSANTE_C_REF", "TN_FIM_FASEA_REF", "TN_FIM_FASEB_REF", "TN_FIM_FASEC_REF", "OLD_NR_CIRCUITO", "ID_CIRCUITO", "ID_PRPR_TRECHO_CSE", "PRI_TRAFO_DIST_ID", "EX_TRECHO_SECDR", "ID_AREA_OBJETO", "PRI_MUNICIPIO_ID", "AREA_REGL_RSPDD_ID", "PRI_CONJUNTO_CNS_ID", "ID_CONNECTED", "ID_ENERGIZED", "IN_CARGM_FASE_A",
"IN_CARGM_FASE_B", "IN_CARGM_FASE_C", "IN_CARGM_FASE_NEUTRO", "IN_QUEDA_TN_FASEA", "IN_QUEDA_TN_FASEB", "IN_QUEDA_TN_FASEC", "IN_PERDA_ATIV_FASEA", "IN_PERDA_ATIV_FASEB", "IN_PERDA_ATIV_FASEC", "IN_PERDA_REAT_FASEA", "IN_PERDA_REAT_FASEB", "IN_PERDA_REAT_FASEC", "IN_APPARENT_POWER_PHASE_A", "IN_APPARENT_POWER_PHASE_B", "IN_APPARENT_POWER_PHASE_C", "IN_ACTIVE_POWER_PHASE_A", "IN_ACTIVE_POWER_PHASE_B", "IN_ACTIVE_POWER_PHASE_C")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT A.ID COD_ID,
FIX_PN_1.FEATURE_ID PN_CON_1,
FIX_PN_2.FEATURE_ID PN_CON_2,
NVL(TFD_F.ID, 0) UNI_TR_D,
NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
--0 UNI_TR_S,
NVL(SUB.SG_SUBESTACAO, 0) SUB,
NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
DECODE(B.ID_AREA_OBJETO,
'U', 'UB',
'R', 'NU') ARE_LOC,
DECODE(TFD.ID_FASE_LIGADA_TD, 1, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 2, 'BN', 4, 'ABN', 8,'N',9,'CMD',10, 'N', '-1'),
                              2, DECODE(B.ID_FASE_TRECHO_CSE, 2,'BN', 3, 'CN', 6, 'BCN', 8,'N',9,'CMD',10, 'N', '-2'),
                              3, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 3, 'CN', 5, 'CAN', 8,'N',9,'CMD',10, 'N', '-3'),
                              4, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 2, 'BN', 4, 'ABN', 8,'N',9,'CMD',10, 'N', '-4'),
                              5, DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN', 3, 'CN', 5, 'CAN', 8,'N',9,'CMD',10, 'N', '-5'),
                              6, DECODE(B.ID_FASE_TRECHO_CSE, 2,'BN', 3, 'CN', 6, 'BCN', 8,'N',9,'CMD',10, 'N', '-6'),
                              7, DECODE(B.ID_FASE_TRECHO_CSE,1,'AN',2, 'BN',3, 'CN',4, 'ABN',5, 'CAN',6, 'BCN',7, 'ABCN',8, 'N',9,'CMD',10, 'N','-7'),
                              DECODE(B.ID_FASE_TRECHO_CSE, 1,'AN',2, 'BN',3, 'CN',4, 'ABN',5, 'CAN',6, 'BCN',7, 'ABCN', 8,'N',9,'CMD',10, 'N', '-8')) FAS_CON,
/*DECODE(B.ID_FASE_TRECHO_CSE, 1, 'AN',
2, 'BN',
3, 'CN',
4, 'ABN',
5, 'CAN',
6, 'BCN',
7, 'ABCN',
8, 'N',
10, 'N',
'-1') FAS_CON,*/
'5697' DIST,
COALESCE(BY_PASS_CMDO.NR_PTO_ELET_INICIO, NVL2(RDE.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO, 0)) PAC_1,
--NVL2(RDE.NR_PTO_ELET_INICIO, RDE.NR_PTO_ELET_INICIO, 0) PAC_1,
NVL2(RDE.NR_PTO_ELET_FIM, RDE.NR_PTO_ELET_FIM, 0) PAC_2,
--'BT-' || NVL(B.TIPO_CABO_A_ID, 0) || '-' || NVL(B.TIPO_CABO_B_ID, 0) || '-' || NVL(B.TIPO_CABO_C_ID, 0) || '-' || NVL(B.TIPO_CABO_NEUTRO_ID, 0) || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'AEREO'), 0, 5, DECODE(COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO), 3, 4, 7))  TIP_CND,
'BT-' || CASE WHEN B.ID_FASE_TRECHO_CSE IN (1,4,5,7) THEN TO_CHAR(B.TIPO_CABO_A_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (2,6) THEN TO_CHAR(B.TIPO_CABO_B_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (3) THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0'
END || '-' || CASE WHEN B.ID_FASE_TRECHO_CSE IN (4,7) THEN TO_CHAR(B.TIPO_CABO_B_ID)
WHEN B.ID_FASE_TRECHO_CSE IN (5,6) THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0'
END || '-' || CASE WHEN B.ID_FASE_TRECHO_CSE = 7 THEN TO_CHAR(B.TIPO_CABO_C_ID)
ELSE '0' --VVV PRECISOU MUDAR POR CAUSA DO NEUTRO
END || '-' || NVL(COALESCE(B.TIPO_CABO_NEUTRO_ID, B.TIPO_CABO_A_ID, B.TIPO_CABO_B_ID, B.TIPO_CABO_C_ID), 0) || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'Aereo'), 0, 5, DECODE(COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO), 3, 4, 7)) TIP_CND,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'PD',
2, 'CS',
'-1') POS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '0',
DECODE(B.ID_PRPR_TRECHO_CSE, 1, '190400',
2, '0',
'-1')) ODI_FAS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '00',
DECODE(B.ID_PRPR_TRECHO_CSE, 2, '00',
DECODE(A.FEATURE_TYPE, 'TrechoSecundarioSubterraneo', DECODE(B.ID_AREA_OBJETO, 'U', '42',
'R', '43'),
'TrechoSecundarioAereo', DECODE(B.ID_AREA_OBJETO, 'U', '40',
'R', '41'),
'-1')
)) TI_FAS,
DECODE(B.ID_FASE_TRECHO_CSE, 8, '0',
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'AT1',
2, '0')) SITCONTFAS,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, '190400',
2, '0') ODI_NEU,
DECODE(B.ID_PRPR_TRECHO_CSE, 2, '00',
DECODE(A.FEATURE_TYPE, 'TrechoSecundarioSubterraneo', DECODE(B.ID_AREA_OBJETO, 'U', '42',
'R', '43'),
'TrechoSecundarioAereo', DECODE(B.ID_AREA_OBJETO, 'U', '40',
'R', '41'),
'-1')
) TI_NEU,
DECODE(B.ID_PRPR_TRECHO_CSE, 1, 'AT1',
2, '0') SITCONTNEU,
A.LENGTH COMP,
'BT, ' || B.ID || ', ' || A.FEATURE_TYPE || ', '|| COALESCE(B.ID_TIPO_REDE_A, B.ID_TIPO_REDE_B, B.ID_TIPO_REDE_C, B.ID_TIPO_REDE_NEUTRO) || ', '|| B.ID_PRPR_TRECHO_CSE || ', '|| B.OLD_FEAT_NUM || ', '|| B.OLD_FEAT_CODE || ', '|| B.ID_FASE_TRECHO_CSE || ', '|| A.TEXT || ', '|| B.OLD_CD_CABO_FASE_A_CSE || ', '|| B.OLD_CD_CABO_FASE_B_CSE || ', '|| B.OLD_CD_CABO_FASE_C_CSE || ', '|| B.OLD_CD_CABO_NEUTRO_CSE DESCR,
A.GEOMETRY,
B."ID",B."OLD_FEAT_NUM",B."OLD_FEAT_CODE",B."ID_FASE_TRECHO_CSE",B."TIPO_CABO_A_ID",B."OLD_CD_CABO_FASE_A_CSE",B."ID_TIPO_REDE_A",B."TIPO_CABO_B_ID",B."OLD_CD_CABO_FASE_B_CSE",B."ID_TIPO_REDE_B",B."TIPO_CABO_C_ID",B."OLD_CD_CABO_FASE_C_CSE",B."ID_TIPO_REDE_C",B."TIPO_CABO_NEUTRO_ID",B."OLD_CD_CABO_NEUTRO_CSE",B."ID_TIPO_REDE_NEUTRO",B."QT_ESPCD_VAO_CSE",B."OLD_FEAT_NUM_TD",B."CR_PASSANTE_FASEA",B."CR_PASSANTE_FASEB",B."CR_PASSANTE_FASEC",B."CR_PASSANTE_NEUTRO",B."TN_FIM_TRSEC_FASEA",B."TN_FIM_TRSEC_FASEB",B."TN_FIM_TRSEC_FASEC",B."IN_CARGM_TRSEC_REF",B."CR_PASSANTE_A_REF",B."CR_PASSANTE_B_REF",B."CR_PASSANTE_C_REF",B."TN_FIM_FASEA_REF",B."TN_FIM_FASEB_REF",B."TN_FIM_FASEC_REF",B."OLD_NR_CIRCUITO",B."ID_CIRCUITO",B."ID_PRPR_TRECHO_CSE",B."PRI_TRAFO_DIST_ID",B."EX_TRECHO_SECDR",B."ID_AREA_OBJETO",B."PRI_MUNICIPIO_ID",B."AREA_REGL_RSPDD_ID",B."PRI_CONJUNTO_CNS_ID",B."ID_CONNECTED",B."ID_ENERGIZED",B."IN_CARGM_FASE_A",B."IN_CARGM_FASE_B",B."IN_CARGM_FASE_C",B."IN_CARGM_FASE_NEUTRO",B."IN_QUEDA_TN_FASEA",B."IN_QUEDA_TN_FASEB",B."IN_QUEDA_TN_FASEC",B."IN_PERDA_ATIV_FASEA",B."IN_PERDA_ATIV_FASEB",B."IN_PERDA_ATIV_FASEC",B."IN_PERDA_REAT_FASEA",B."IN_PERDA_REAT_FASEB",B."IN_PERDA_REAT
_FASEC",B."IN_APPARENT_POWER_PHASE_A",B."IN_APPARENT_POWER_PHASE_B",B."IN_APPARENT_POWER_PHASE_C",B."IN_ACTIVE_POWER_PHASE_A",B."IN_ACTIVE_POWER_PHASE_B",B."IN_ACTIVE_POWER_PHASE_C"
FROM PRI_TRECHO_SECDR_F A
LEFT JOIN PRI_TRECHO_SECDR B ON A.PRI_TRECHO_SECDR_ID = B.ID
LEFT JOIN CR_ACC_POINT_LINK FIX ON A.ID = FIX.FEATURE_ID
LEFT JOIN CR_ACC_POINT FIX_PN_1 ON FIX.ID_CR_ACC_POINT_1 = FIX_PN_1.ID
LEFT JOIN CR_ACC_POINT FIX_PN_2 ON FIX.ID_CR_ACC_POINT_2 = FIX_PN_2.ID
--LEFT JOIN VA_MUNICIPIO_ANEEL MUN
--ON B.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ ON B.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
LEFT JOIN RDE_CONEC_CSE RDE ON RDE.FEATURE_ID = A.ID
LEFT JOIN PRI_TRAFO_DIST TFD ON TFD.ID = B.PRI_TRAFO_DIST_ID
LEFT JOIN PRI_TRAFO_DIST_F TFD_F ON TFD.ID = TFD_F.PRI_TRAFO_DIST_ID
LEFT JOIN PRI_ALIMENTADOR ALI ON TFD.PRI_ALIMENTADOR_ID = ALI.ID
LEFT JOIN PRI_SUBESTACAO SUB ON ALI.PRI_SUBESTACAO_ID = SUB.ID
LEFT JOIN BDGD.VAUX_BY_PASS_COMANDO_IP BY_PASS_CMDO ON BY_PASS_CMDO.NR_PTO_ELET_FIM = RDE.NR_PTO_ELET_INICIO
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SSDMT" ("COD_ID", "PN_CON_1", "PN_CON_2", "CTMT", "SUB", "CONJ", "ARE_LOC", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_CND", "POS", "ODI_FAS", "TI_FAS", "SITCONTFAS", "ODI_NEU", "TI_NEU", "SITCONTNEU", "COMP", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT /* +INDEX SDX_PRI_TRECHO_PRIM_F */ A.ID COD_ID,
FIX_PN_1.FEATURE_ID PN_CON_1,
FIX_PN_2.FEATURE_ID PN_CON_2,
NVL(ALI.CD_ALIMENTADOR, 0) CTMT,
--CAST( NULL AS VARCHAR2(255) ) UNI_TR_S,
SUB.SG_SUBESTACAO SUB,
NVL(CONJ.NR_CONJUNTO_ANEEL, 0) CONJ,
DECODE(B.ID_AREA_OBJETO,
'U', 'UB',
'R', 'NU') ARE_LOC,
'5697' DIST,
RDE.NR_PTO_ELET_INICIO PAC_1,
RDE.NR_PTO_ELET_FIM PAC_2,
DECODE(B.ID_FASE_TRECHO_PRI, 1, 'A',
2, 'B',
3, 'C',
4, 'AB',
5, 'CA',
6, 'BC',
7, 'AB',
8, 'CA',
9, 'BC',
10, 'ABC',
11, 'ABC',
12, 'ABC',
13, 'ABC',
14, 'ABC',
15, 'ABC') FAS_CON,
/*'MT-' || NVL(B.TIPO_CABO_DIST_ID, 0) || '-' || B.ID_FASE_TRECHO_PRI || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'AEREO'), 0, 5, DECODE(B.ID_TIPO_REDE, 1, 1, 3, 4, CASE WHEN GEOM."3" >= 1 THEN 3
                                                                                                                                                                             WHEN GEOM."1" >= 1 THEN 1
                                                                                                                                                                                 WHEN GEOM."6" >= 1 THEN 6
                                                                                                                                                                                 WHEN GEOM."7" >= 1 THEN 7
                                                                                                                                                                                 WHEN GEOM."4" >= 1 THEN 4
                                                                                                                                                                                 WHEN GEOM.TRECHO_ID IS NULL THEN 3
                                                                                                                                                                                 ELSE -2
                                                                                                                                                                            END)) TIP_CND,*/
'MT-' || NVL(B.TIPO_CABO_DIST_ID, 0) || '-' || CASE WHEN B.ID_FASE_TRECHO_PRI IN (1,2,3) THEN 1
WHEN B.ID_FASE_TRECHO_PRI IN (4,5,6,7,8,9) THEN 2
WHEN B.ID_FASE_TRECHO_PRI >= 10 THEN 3 END || '-' || DECODE(REGEXP_INSTR(A.FEATURE_TYPE, 'Aereo'), 0, 5, DECODE(B.ID_TIPO_REDE, 1, 1, 3, 4, 9, 1, CASE WHEN GEOM."3" >= 1 THEN 3
WHEN GEOM."1" >= 1 THEN 1
WHEN GEOM."6" >= 1 THEN 6
WHEN GEOM."7" >= 1 THEN 7
WHEN GEOM."4" >= 1 THEN 4
WHEN GEOM.TRECHO_ID IS NULL THEN 3
ELSE 3
END)) TIP_CND,
DECODE(COALESCE(B.ID_PRPR_TRECHO_PRI, 1), 1, 'PD',
2, 'CS') POS,
DECODE(COALESCE(B.ID_PRPR_TRECHO_PRI, 1), 1, '190400',
2, '0') ODI_FAS,
DECODE(COALESCE(B.ID_PRPR_TRECHO_PRI, 1), 2, '00',
1, DECODE(A.FEATURE_TYPE, 'TrechoPrimarioSubterraneo', DECODE(B.ID_AREA_OBJETO, 'U', '42',
'R', '43'),
'TrechoPrimarioAereo', DECODE(B.ID_AREA_OBJETO, 'U', '40',
'R', '41'),
'-1'),
'-2') TI_FAS,
DECODE(COALESCE(B.ID_PRPR_TRECHO_PRI, 1), 1, 'AT1',
2, '0') SITCONTFAS,
'0' ODI_NEU,
'00' TI_NEU,
'0' SITCONTNEU,
A.LENGTH COMP,
'MT, ' || B.ID || ', ' || A.FEATURE_TYPE || ', '|| B.ID_PRPR_TRECHO_PRI || ', '|| B.OLD_FEAT_NUM || ', '|| B.ID || ', '|| B.ID_FASE_TRECHO_PRI || ', '|| A.TEXT DESCR,
A.GEOMETRY
--SELECT *
FROM PRI_TRECHO_PRIM_F A
LEFT JOIN PRI_TRECHO_PRIM B
ON A.PRI_TRECHO_PRIM_ID = B.ID
LEFT JOIN CR_ACC_POINT_LINK FIX
ON A.ID = FIX.FEATURE_ID
LEFT JOIN CR_ACC_POINT FIX_PN_1
ON FIX.ID_CR_ACC_POINT_1 = FIX_PN_1.ID
LEFT JOIN CR_ACC_POINT FIX_PN_2
ON FIX.ID_CR_ACC_POINT_2 = FIX_PN_2.ID
--LEFT JOIN VA_MUNICIPIO_ANEEL MUN
--ON B.PRI_MUNICIPIO_ID = MUN.PRI_MUNICIPIO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ
ON B.PRI_CONJUNTO_CNS_ID = CONJ.PRI_CONJUNTO_CNS_ID
LEFT JOIN RDE_CONEC_CPR RDE
ON RDE.FEATURE_ID = A.ID
LEFT JOIN PRI_ALIMENTADOR ALI
ON B.PRI_ALIMENTADOR_ID = ALI.ID
LEFT JOIN V_GEOM_MT GEOM
ON GEOM.TRECHO_ID = A.ID
LEFT JOIN PRI_SUBESTACAO SUB
ON SUB.ID = ALI.PRI_SUBESTACAO_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SUB" ("COD_ID", "DIST", "POS", "NOM", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT SAP.SG_SUBESTACAO COD_ID,
'5697' DIST,
DECODE(SAP.ID_PRPRD_ESTACAO, 1, 'PD',
2, 'CS',
3, 'T',
4, 'CO',
6, 'OD',
8, 'T',
'-1') POS,
SAP.NM_SUBESTACAO NOM,
B.NR_SUBESTACAO || ', ' || SAP.NR_SUBESTACAO || ', ' || B.SG_SUBESTACAO || ', ' || SAP.SG_SUBESTACAO || ', ' || B.NM_SUBESTACAO || ', ' || SAP.NM_SUBESTACAO || ', ' || SAP.ID_PRPRD_ESTACAO || ', ' || A.PRI_SUBESTACAO_ID || ', ' || SAP.NR_LOCALINST_GEN DESCR,
A.GEOMETRY
FROM PRI_SUBESTACAO_F A
LEFT JOIN PRI_SUBESTACAO B ON A.PRI_SUBESTACAO_ID = B.ID
LEFT JOIN TAB_SAP_SUBESTACAO SAP ON SAP.NR_LOCALINST_GEN = B.NR_LOCALINST_GEN
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_SUGERE_FASE_BT" ("FEATURE_ID", "FEATURE_TYPE", "ID_TRANSFORMADOR", "LEVEL", "FASE_TRAFO_PRIMARIO", "FASE_TRAFO_SECUNDARIO", "FASE_TRAFO_TERCIARIO", "FASE_OBJETO", "FASE_PAI", "FASE_SUGERIDA", "STATUS_FASE")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select distinct *  
from 
(
SELECT CONEC.*,
CASE 
WHEN (FASE_TRAFO_SECUNDARIO = 'ABCN' AND (FEATURE_TYPE = 'TrafoDistAereo' OR FEATURE_TYPE ='TrafoDistSubterraneo') OR FEATURE_TYPE = 'TrafoDistSubterraneo') THEN CONEC.FASE_OBJETO
WHEN (FASE_TRAFO_SECUNDARIO = 'ABCN' AND FEATURE_TYPE <> 'TrafoDistAereo' AND FEATURE_TYPE <> 'TrafoDistSubterraneo' AND  CONEC.FASE_OBJETO <> 'N' ) THEN CONEC.FASE_OBJETO || 'N'
WHEN (FASE_TRAFO_SECUNDARIO = 'AN' AND CONEC.FASE_OBJETO = 'A') THEN CONEC.FASE_OBJETO || 'N'
WHEN (FASE_TRAFO_SECUNDARIO = 'BN' AND CONEC.FASE_OBJETO = 'A') THEN 'BN'
WHEN (FASE_TRAFO_SECUNDARIO = 'BN' AND CONEC.FASE_OBJETO = 'B') THEN 'CN'
WHEN (FASE_TRAFO_SECUNDARIO = 'BN' AND CONEC.FASE_OBJETO = 'AB') THEN 'BCN'
WHEN (FASE_TRAFO_SECUNDARIO = 'CN' AND CONEC.FASE_OBJETO = 'AB') THEN 'CAN'
WHEN (FASE_TRAFO_SECUNDARIO = 'CN' AND CONEC.FASE_OBJETO = 'A') THEN 'CN'
WHEN (FASE_TRAFO_SECUNDARIO = 'CN' AND CONEC.FASE_OBJETO = 'B') THEN 'AN'
WHEN (CONEC.FASE_OBJETO = 'N') THEN CONEC.FASE_OBJETO
ELSE CONEC.FASE_OBJETO || 'N'
END AS FASE_SUGERIDA,
CASE 
WHEN (REGEXP_LIKE(FASE_PAI, '(.*['||FASE_OBJETO ||'].*){'|| LENGTH(FASE_OBJETO) ||'}') OR FASE_PAI = '0') OR (FEATURE_TYPE = 'TrafoDistAereo' OR FEATURE_TYPE ='TrafoDistSubterraneo') THEN 'OK'
ELSE 'ERRO'
END AS STATUS_FASE
FROM 
(SELECT 
REDE_BT.FEATURE_ID,
REDE_BT.FEATURE_TYPE,
REDE_BT.ID_TRANSFORMADOR,
REDE_BT."LEVEL",
CASE
WHEN TD.FAS_CON_P = 1 THEN 'A'
WHEN TD.FAS_CON_P = 2 THEN 'B'
WHEN TD.FAS_CON_P = 3 THEN 'C'
WHEN TD.FAS_CON_P = 4 THEN 'AB'
WHEN TD.FAS_CON_P = 5 THEN 'CA'--'BC'
WHEN TD.FAS_CON_P = 6 THEN 'BC'--'CA'
WHEN TD.FAS_CON_P = 7 THEN 'ABC'
END AS FASE_TRAFO_PRIMARIO,
CASE
WHEN TD.FAS_CON_P = 1 THEN 'AN'
WHEN TD.FAS_CON_P = 2 THEN 'BN'
WHEN TD.FAS_CON_P = 3 THEN 'CN'
WHEN TD.FAS_CON_P = 4 THEN 'AN'
WHEN TD.FAS_CON_P = 5 THEN 'CN'--'BN'
WHEN TD.FAS_CON_P = 6 THEN 'BN'--'CN'
WHEN TD.FAS_CON_P = 7 THEN 'ABCN'
ELSE 'ABCN'
END AS FASE_TRAFO_SECUNDARIO,
CASE
WHEN TD.FAS_CON_P = 1 THEN 'BN'
WHEN TD.FAS_CON_P = 2 THEN 'CN'
WHEN TD.FAS_CON_P = 3 THEN 'AN'
WHEN TD.FAS_CON_P = 4 THEN 'BN'
WHEN TD.FAS_CON_P = 5 THEN 'AN'--'CN'
WHEN TD.FAS_CON_P = 6 THEN 'CN'--'AN'
WHEN TD.FAS_CON_P = 7 THEN '0'
ELSE 'ABCN'
END AS FASE_TRAFO_TERCIARIO,
CASE
WHEN (REDE_BT.FEATURE_TYPE = 'TrafoDistAereo' OR REDE_BT.FEATURE_TYPE = 'TrafoDistSubterraneo')  THEN B.FASE ||'N'
ELSE B.FASE
END FASE_OBJETO,
CASE
WHEN PRE_CMD.FASE_PAI_CMD IS NOT NULL THEN PRE_CMD.FASE_PAI_CMD
ELSE PAI.FASE 
END AS FASE_PAI
FROM MV_GENESIS_AUD_REDE_BT REDE_BT 
INNER JOIN MV_GENESIS_EQTRD TD
ON TD.ID = REDE_BT.ID_TRANSFORMADOR
INNER JOIN MV_PRE_FASE_BT B
ON FEATURE_ID = B.ID  
LEFT JOIN RDE_CONEC_CSE RDE
ON RDE.NR_PTO_ELET_FIM = REDE_BT.PAC_PAI
LEFT JOIN MV_PRE_FASE_BT PAI
ON PAI.ID = RDE.FEATURE_ID
LEFT JOIN MV_PRE_IP_COMANDO PRE_CMD
ON PRE_CMD.ID_IP = REDE_BT.FEATURE_ID
) CONEC)
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_TAB_SAP_SUBESTACAO" ("NR_SUBESTACAO", "NR_REGIONAL", "NM_SUBESTACAO", "SG_SUBESTACAO", "ID_CATEGORIA_SE", "CD_MUNICIPIO", "ID_MTRMT_SE", "ID_AREA_RESP_ESTACAO", "ID_SIT_ESTACAO", "ID_MTRMT_ESTACAO", "ID_PRPRD_ESTACAO", "PO_TOT_PREVISTA", "NR_DIA_PREVISAO_OPER", "NR_MES_PREVISAO_OPER", "NR_ANO_PREVISAO_OPER", "NR_DIA_SAIDA_OPER", "NR_MES_SAIDA_OPER", "NR_ANO_SAIDA_OPER", "DT_INICIO_TELESSINALIZACAO", "DT_INICIO_TELECONTROLE", "ID_SIT_SINAL_SDSC", "ID_REG_GEOELETRICA", "QT_TRAFO_ESTACAO", "QT_ALIMENTADOR_ESTACAO", "DS_NIVEL_TN_NOMINAL", "ID_ESTACAO_TRANF_SIST_ELET", "NR_LOCALINST_SAP", "NR_LOCALINST_GEN", "NM_FAMILIA_ELEMENTO", "NR_LOGRADOURO", "NR_BAIRRO", "NR_NO_LOGRADOURO", "DS_COMPLEMENTO")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM TAB_SAP_SUBESTACAO
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_TRAFO_CNS_MT" ("ID_TRAFO", "MEDIA", "BAIXA")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT ID_TRAFO,Media,Baixa FROM
 (
  SELECT 
  F.ID  AS ID_TRAFO,
  SUM(CASE WHEN CNS.ID_GRUPO_TENSAO_CNS_FAT='A' THEN 1  ELSE 0 END) as Media,
  SUM(CASE WHEN CNS.ID_GRUPO_TENSAO_CNS_FAT='B' THEN 1  ELSE 0 END) as Baixa
  FROM RDE_UND_CNS_RAMAL CNS_RAMAL 
  INNER JOIN RDE_UND_CNS CNS ON CNS.NR_CONTA_CNS = CNS_RAMAL.NR_CONTA_CNS
  INNER JOIN PRI_RAMAL_LIG_CNS RAMAL ON RAMAL.ID = CNS_RAMAL.PRI_RAMAL_LIG_CNS_ID
  INNER JOIN PRI_TRAFO_DIST_F F ON F.PRI_TRAFO_DIST_ID = RAMAL.PRI_TRAFO_DIST_ID 
  GROUP BY F.ID
  )
  WHERE
  Media>0  and Baixa=0
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_TRD_CNS" ("NR_LOCZ_EQPTO_RD", "AREA_REGL_RSPDD_ID", "NR_CONTA_CNS", "ID_GRUPO_TENSAO_UND_CNS", "ID_GRUPO_TENSAO_CNS_FAT", "ID_PRPR_TRAFO_DIST", "RANK")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM (
SELECT A.*, RANK() OVER (PARTITION BY NR_LOCZ_EQPTO_RD ORDER BY NR_CONTA_CNS) AS "RANK" 
FROM
(
SELECT   TRAFO.NR_LOCZ_EQPTO_RD,
         TRAFO.AREA_REGL_RSPDD_ID,
         RDE.NR_CONTA_CNS,
         RDE2.ID_GRUPO_TENSAO_UND_CNS,
         RDE2.ID_GRUPO_TENSAO_CNS_FAT,
         TRAFO.ID_PRPR_TRAFO_DIST
FROM VS_PRI_TRAFO_DIST TRAFO
INNER JOIN RDE_UND_CNS_RAMAL RDE
    ON RDE.NR_LOCZ_EQPTO_RD = TRAFO.NR_LOCZ_EQPTO_RD
        AND RDE.NR_REGIONAL_TRAFO = TRAFO.AREA_REGL_RSPDD_ID
INNER JOIN 
    (SELECT *
    FROM RDE_UND_CNS
    WHERE ID_GRUPO_TENSAO_UND_CNS <> ID_GRUPO_TENSAO_CNS_FAT) RDE2
    ON RDE2.NR_CONTA_CNS = RDE.NR_CONTA_CNS

WHERE TRAFO.ID_PRPR_TRAFO_DIST <> 1
) A) B
WHERE B.RANK = 1
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UCAT" ("COD_ID", "PN_CON", "PAC", "CTAT", "SUB", "CONJ", "ARE_LOC", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT
/*+ LEADING(RAMAL) USE_NL(RAMAL RAMAL) INDEX(RAMAL SDX_PRI_RAMAL_LIG_CNS_F)*/
/*+ LEADING(CONJ) USE_NL(CONJ CONJ) INDEX(CONJ SDX_PRI_CONJUNTO_CNS_F)*/
/*+ LEADING(TFD) USE_NL(TFD TFD) INDEX(TFD SDX_PRI_TRAFO_DIST_F)*/
/*+ LEADING(ALI) USE_NL(ALI ALI) INDEX(ALI SDX_PRI_ALIMENTADOR_F)*/
/*+ LEADING(SUB) USE_NL(SUB SUB) INDEX(SUB SDX_PRI_SUBESTACAO_F)*/
/*+ LEADING(VAO) USE_NL(VAO VAO) INDEX(VAO SDX_PRI_VAO_LTR_F)*/
RDE.NR_CONTA_CNS COD_ID,
NVL(FIX_PN.FEATURE_ID, 0) PN_CON,
NVL(CON.NR_PTO_ELET_FIM, 0) PAC,
TRMSS.NR_LINHA_TRMSS CTAT,
COALESCE(SUB.SG_SUBESTACAO, SUB_R.SG_SUBESTACAO, '0') SUB,
CONJ.NR_CONJUNTO_ANEEL AS CONJ,
DECODE(RAMAL.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', -1) AS ARE_LOC,
RAMAL.ID DESCR,
--SDO_GEOMETRY(2001, 31982, SDO_POINT_TYPE(TRUNC(RAMAL.COORD_X, 2), TRUNC(RAMAL.COORD_Y, 2), NULL), NULL, NULL) GEOMETRY
SDO_GEOMETRY(2001, 31982, SDO_POINT_TYPE(coord.COORD_X, coord.COORD_Y, NULL), NULL, NULL) GEOMETRY
--select *
FROM V_CNS_MAPA_AT RDE
LEFT JOIN VS_PRI_RAMAL_LIG_CNS RAMAL
ON RAMAL.PRI_RAMAL_LIG_CNS_ID = RDE.PRI_RAMAL_LIG_CNS_ID
LEFT JOIN VA_CONJUNTO_ANEEL CONJ
ON CONJ.PRI_CONJUNTO_CNS_ID = RAMAL.PRI_CONJUNTO_CNS_ID
LEFT JOIN RDE_CONEC_LTR CON
ON CON.FEATURE_ID = RAMAL.ID
LEFT JOIN CR_ACC_POINT_LINK FIX
ON FIX.FEATURE_ID = RAMAL.ID
LEFT JOIN CR_ACC_POINT FIX_PN
ON FIX_PN.ID = COALESCE(FIX.ID_CR_ACC_POINT_1, FIX.ID_CR_ACC_POINT_2)
LEFT JOIN VS_PRI_TRAFO_DIST TFD
ON TFD.PRI_TRAFO_DIST_ID = RAMAL.PRI_TRAFO_DIST_ID
LEFT JOIN VS_PRI_ALIMENTADOR ALI
ON ALI.PRI_ALIMENTADOR_ID = TFD.PRI_ALIMENTADOR_ID
LEFT JOIN VS_PRI_SUBESTACAO SUB
ON SUB.PRI_SUBESTACAO_ID = ALI.PRI_SUBESTACAO_ID
LEFT JOIN VS_PRI_VAO_LTR VAO
ON FNC_PAI_AT(CON.NR_PTO_ELET_INICIO) = VAO.ID
LEFT JOIN TAB_SAP_LINHA_TRMSS TRMSS
ON TRMSS.NR_LINHA_TRMSS = VAO.NR_LINHA_TRMSS
LEFT JOIN gen_bdgd2019.VAUX_SUB_POR_RAMAL SUB_R
on SUB_R.ID = RAMAL.ID
left join gen_bdgd2019.mV_cns_ramal_coord coord
    on coord.nr_conta_cns = RDE.NR_CONTA_CNS
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UCBT" ("COD_ID", "PAC", "PN_CON", "UNI_TR_D", "CTMT", "SUB", "CONJ", "FAS_CON", "ARE_LOC", "SEMRED", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT RDE.NR_CONTA_CNS COD_ID,
       --NVL(CON.NR_PTO_ELET_INICIO, 0)  PAC,
       NVL(CON.NR_PTO_ELET_FIM, 0)  PAC,
       NVL(FIX_PN.FEATURE_ID, 0) PN_CON,
       NVL(TFD.ID, 0) UNI_TR_D,
       NVL(ALI.CD_ALIMENTADOR,0) CTMT,
       --NULL UNI_TR_S,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       CONJ.NR_CONJUNTO_ANEEL CONJ,
       DECODE(RDE.ID_FASE, 1, 'AN', 2, 'BN', 3, 'CN', 4, 'ABN', 5,'CAN' , 6, 'BCN', 7, 'ABCN') FAS_CON,
       DECODE(RAMAL.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', -1) ARE_LOC,
       DECODE(RDE.ID_SITUACAO_CNS, 'DS', 1, 0) SEMRED,
       RAMAL.ID || ',' || TFD.ID || ',' || RDE.ID_SITUACAO_CNS || ',' || RAMAL.ID_CONNECTED || ',' || RAMAL.ID_ENERGIZED  DESCR,
       --SDO_GEOMETRY(2001, 31982, SDO_POINT_TYPE(TRUNC(RAMAL.COORD_X, 2), TRUNC(RAMAL.COORD_Y, 2), NULL), NULL, NULL) GEOMETRY
       SDO_GEOMETRY(2001, 31982, SDO_POINT_TYPE(coord.COORD_X, coord.COORD_Y, NULL), NULL, NULL) GEOMETRY
FROM V_CNS_MAPA_BT RDE
     LEFT JOIN VS_PRI_RAMAL_LIG_CNS RAMAL
          ON RDE.PRI_RAMAL_LIG_CNS_ID = RAMAL.PRI_RAMAL_LIG_CNS_ID
     LEFT JOIN RDE_CONEC_CSE CON
          ON CON.FEATURE_ID = RAMAL.ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON CONJ.PRI_CONJUNTO_CNS_ID = RAMAL.PRI_CONJUNTO_CNS_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON FIX.FEATURE_ID = RAMAL.ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX_PN.ID = COALESCE(FIX.ID_CR_ACC_POINT_1, FIX.ID_CR_ACC_POINT_2)
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.PRI_TRAFO_DIST_ID = RAMAL.PRI_TRAFO_DIST_ID
     LEFT JOIN VS_PRI_ALIMENTADOR ALI
          ON ALI.PRI_ALIMENTADOR_ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN VS_PRI_SUBESTACAO SUB
          ON SUB.PRI_SUBESTACAO_ID = ALI.PRI_SUBESTACAO_ID
     left join gen_bdgd2019.mV_cns_ramal_coord coord
          on coord.nr_conta_cns = RDE.NR_CONTA_CNS
WHERE RDE.NR_CONTA_CNS NOT IN (12249543,
20965231,
12248385,
20946865,
12267002,
12249314,
12250550,
12249691,
8974837,
12249896,
20980265,
1314769,
3518825,
12246013,
31372437
)
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UCMT" ("COD_ID", "PN_CON", "PAC", "CTMT", "SUB", "CONJ", "ARE_LOC", "SEMRED", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT RDE.NR_CONTA_CNS COD_ID,
       NVL(FIX_PN.FEATURE_ID, 0) PN_CON,
       NVL(CON.NR_PTO_ELET_INICIO, 0)  PAC,
       NVL(ALI.CD_ALIMENTADOR,0) CTMT,
       --NULL UNI_TR_S,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       CONJ.NR_CONJUNTO_ANEEL CONJ,
       DECODE(RAMAL.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', -1) ARE_LOC,
       DECODE(RDE.ID_SITUACAO_CNS, 'DS', 1, 0) SEMRED,
       RAMAL.ID || ',' || TFD.ID || ',' || RDE.ID_SITUACAO_CNS DESCR,
       --SDO_GEOMETRY(2001, 31982, SDO_POINT_TYPE(REPLACE(TRUNC(RAMAL.COORD_X, 2), ',', '.'), REPLACE(TRUNC(RAMAL.COORD_Y, 2), ',', '.'), NULL), NULL, NULL) GEOMETRY
       SDO_GEOMETRY(2001, 31982, SDO_POINT_TYPE(coord.COORD_X, coord.COORD_Y, NULL), NULL, NULL) GEOMETRY
FROM V_CNS_MAPA_MT RDE
     LEFT JOIN VS_PRI_RAMAL_LIG_CNS RAMAL
          ON RDE.PRI_RAMAL_LIG_CNS_ID = RAMAL.PRI_RAMAL_LIG_CNS_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON CONJ.PRI_CONJUNTO_CNS_ID = RAMAL.PRI_CONJUNTO_CNS_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON FIX.FEATURE_ID = RAMAL.ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX_PN.ID = COALESCE(FIX.ID_CR_ACC_POINT_1, FIX.ID_CR_ACC_POINT_2)
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.PRI_TRAFO_DIST_ID = RAMAL.PRI_TRAFO_DIST_ID
     LEFT JOIN RDE_CONEC_CPR CON
          ON CON.FEATURE_ID = TFD.ID
     LEFT JOIN VS_PRI_ALIMENTADOR ALI
          ON ALI.PRI_ALIMENTADOR_ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN VS_PRI_SUBESTACAO SUB
          ON SUB.PRI_SUBESTACAO_ID = ALI.PRI_SUBESTACAO_ID
     left join gen_bdgd2019.mV_cns_ramal_coord coord
         on coord.nr_conta_cns = RDE.NR_CONTA_CNS
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UC_BT" ("COD_ID", "PAC", "PN_CON", "UNI_TR_D", "CTMT", "SUB", "CONJ", "FAS_CON", "ARE_LOC", "SEMRED", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT RDE.NR_CONTA_CNS COD_ID,
       --NVL(CON.NR_PTO_ELET_INICIO, 0)  PAC,
       NVL(CON.NR_PTO_ELET_FIM, 0)  PAC,
       NVL(FIX_PN.FEATURE_ID, 0) PN_CON,
       NVL(TFD.ID, 0) UNI_TR_D,
       NVL(ALI.CD_ALIMENTADOR,0) CTMT,
       --NULL UNI_TR_S,
       NVL(SUB.SG_SUBESTACAO, 0) SUB,
       CONJ.NR_CONJUNTO_ANEEL CONJ,
       DECODE(RDE.ID_FASE, 1, 'AN', 2, 'BN', 3, 'CN', 4, 'ABN', 5,'CAN' , 6, 'BCN', 7, 'ABCN') FAS_CON,
       DECODE(RAMAL.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', -1) ARE_LOC,
       DECODE(RDE.ID_SITUACAO_CNS, 'DS', 1, 0) SEMRED,
       RAMAL.ID || ',' || TFD.ID || ',' || RDE.ID_SITUACAO_CNS || ',' || RAMAL.ID_CONNECTED || ',' || RAMAL.ID_ENERGIZED  DESCR,
       SDO_GEOMETRY(2001, 31982, SDO_POINT_TYPE(TRUNC(RAMAL.COORD_X, 2), TRUNC(RAMAL.COORD_Y, 2), NULL), NULL, NULL) GEOMETRY

FROM V_CNS_MAPA_BT RDE
     LEFT JOIN VS_PRI_RAMAL_LIG_CNS RAMAL
          ON RDE.PRI_RAMAL_LIG_CNS_ID = RAMAL.PRI_RAMAL_LIG_CNS_ID
     LEFT JOIN RDE_CONEC_CSE CON
          ON CON.FEATURE_ID = RAMAL.ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON CONJ.PRI_CONJUNTO_CNS_ID = RAMAL.PRI_CONJUNTO_CNS_ID
     LEFT JOIN CR_ACC_POINT_LINK FIX
          ON FIX.FEATURE_ID = RAMAL.ID
     LEFT JOIN CR_ACC_POINT FIX_PN
          ON FIX_PN.ID = COALESCE(FIX.ID_CR_ACC_POINT_1, FIX.ID_CR_ACC_POINT_2)
     LEFT JOIN VS_PRI_TRAFO_DIST TFD
          ON TFD.PRI_TRAFO_DIST_ID = RAMAL.PRI_TRAFO_DIST_ID
     LEFT JOIN VS_PRI_ALIMENTADOR ALI
          ON ALI.PRI_ALIMENTADOR_ID = TFD.PRI_ALIMENTADOR_ID
     LEFT JOIN VS_PRI_SUBESTACAO SUB
          ON SUB.PRI_SUBESTACAO_ID = ALI.PRI_SUBESTACAO_ID
WHERE RDE.NR_CONTA_CNS NOT IN (12249543,
20965231,
12248385,
20946865,
12267002,
12249314,
12250550,
12249691,
8974837,
12249896,
20980265,
1314769,
3518825,
12246013,
31372437
)
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNCRMT" ("COD_ID", "NR_EQUIPAMENTO", "DIST", "FAS_CON", "SIT_ATIV", "TIP_UNID", "PAC_1", "PAC_2", "CTMT", "SUB", "CONJ", "MUN", "ARE_LOC", "BANC", "POS", "DESCR", "CD_ALIMENTADOR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT PRI.ID AS COD_ID,
SAP.NR_EQUIPAMENTO,
5697 AS DIST,
CASE
WHEN ID_FASE_LIGADA_BC=1 THEN
'A'
WHEN ID_FASE_LIGADA_BC=2 THEN
'B'
WHEN ID_FASE_LIGADA_BC=3 THEN
'C'
WHEN ID_FASE_LIGADA_BC=7 THEN
'ABC'
ELSE '0'
END AS FAS_CON, 
'AT' AS SIT_ATIV, 
10 AS TIP_UNID, 
CONEC.NR_PTO_ELET_INICIO AS PAC_1, 
CONEC.NR_PTO_ELET_FIM AS PAC_2, 
VSA.CD_ALIMENTADOR AS CTMT, 
VSSBT.SG_SUBESTACAO AS SUB, 
CJA.NR_CONJUNTO_ANEEL AS CONJ, 
MUNA.NR_MUN_ANEEL AS MUN,
CASE
WHEN PRI.ID_AREA_OBJETO='R' THEN
'NU'
ELSE 'UB'
END AS ARE_LOC, 
PRI.ID_BANCO_BC AS BANC, 
'PD' AS POS, 
SAP.NR_LOCALINST_SAP AS DESCR, 
VSA.CD_ALIMENTADOR, 
PRI.GEOMETRY
FROM VS_PRI_BANCO_CAPCT_RD PRI
LEFT JOIN TAB_SAP_BANCO_CAPCT_RD SAP ON SAP.NR_REGIONAL = PRI.AREA_REGL_RSPDD_ID and SAP.NR_LOCZ_EQPTO_RD = PRI.NR_LOCZ_EQPTO_RD
LEFT JOIN RDE_CONEC_CPR CONEC ON CONEC.FEATURE_ID = PRI.ID
LEFT JOIN VS_PRI_ALIMENTADOR VSA ON VSA.PRI_ALIMENTADOR_ID=PRI.PRI_ALIMENTADOR_ID
LEFT JOIN VS_PRI_SUBESTACAO VSSBT ON VSSBT.PRI_SUBESTACAO_ID=VSA.PRI_SUBESTACAO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CJA ON CJA.PRI_CONJUNTO_CNS_ID = PRI.PRI_CONJUNTO_CNS_ID
LEFT JOIN VA_MUNICIPIO_ANEEL MUNA ON MUNA.PRI_MUNICIPIO_ID = PRI.PRI_MUNICIPIO_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNREMT" ("COD_ID", "DIST", "FAS_CON", "SIT_ATIV", "TIP_UNID", "PAC1", "PAC2", "CTMT", "SUB", "CONJ", "MUN", "BANC", "POS", "DESCR", "NR_LOCALINST_GEN", "CD_ALIMENTADOR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT REMT."COD_ID",
REMT."DIST",
REMT."FAS_CON",
REMT."SIT_ATIV",
REMT."TIP_UNID",
REMT."PAC1",
REMT."PAC2",
REMT."CTMT",
REMT."SUB",
REMT."CONJ",
REMT."MUN",
REMT."BANC",
REMT."POS",
REMT."DESCR",
REMT."NR_LOCALINST_GEN",
REMT."CD_ALIMENTADOR",
PRI2.GEOMETRY
FROM 
(SELECT DISTINCT PRI.ID AS COD_ID,
5697 AS DIST,

CASE
WHEN ID_FASE_LIGADA_RG=1 THEN
'A'
WHEN ID_FASE_LIGADA_RG=2 THEN
'B'
WHEN ID_FASE_LIGADA_RG=3 THEN
'C'
WHEN ID_FASE_LIGADA_RG=7 THEN
'ABC'
ELSE '0'
END AS FAS_CON, 'AT' AS SIT_ATIV, 14 AS TIP_UNID, CONEC.NR_PTO_ELET_INICIO AS PAC1, CONEC.NR_PTO_ELET_FIM AS PAC2, 
VSA.CD_ALIMENTADOR AS CTMT, VSSBT.SG_SUBESTACAO AS SUB, CJA.NR_CONJUNTO_ANEEL AS CONJ, 
MUNA.NR_MUN_ANEEL AS MUN, PRI.ID_BANCO_RG AS BANC, PRI.ID_PRPR_RG AS POS, SAP.NR_LOCALINST_SAP AS DESCR, PRI.NR_LOCALINST_GEN, VSA.CD_ALIMENTADOR
FROM VS_PRI_BANCO_REGDR_TN PRI
LEFT JOIN TAB_SAP_BANCO_REGDR_TN SAP
ON PRI.NR_LOCALINST_GEN = SAP.NR_LOCALINST_GEN
LEFT JOIN RDE_CONEC_CPR CONEC
ON CONEC.FEATURE_ID = PRI.ID
LEFT JOIN VS_PRI_ALIMENTADOR VSA
ON VSA.PRI_ALIMENTADOR_ID=PRI.PRI_ALIMENTADOR_ID
LEFT JOIN Vs_PRI_SUBESTACAO VSSBT
ON VSSBT.PRI_SUBESTACAO_ID=VSA.PRI_SUBESTACAO_ID
LEFT JOIN VA_CONJUNTO_ANEEL CJA
ON CJA.PRI_CONJUNTO_CNS_ID = PRI.PRI_CONJUNTO_CNS_ID
LEFT JOIN VA_MUNICIPIO_ANEEL MUNA
ON MUNA.PRI_MUNICIPIO_ID = PRI.PRI_MUNICIPIO_ID ) REMT
LEFT JOIN VS_PRI_BANCO_REGDR_TN PRI2
ON PRI2.NR_LOCALINST_GEN = REMT.NR_LOCALINST_GEN
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNSEMT_1" ("COD_ID", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_UNID", "P_N_OPE", "POS", "CTMT", "UNI_TR_S", "SUB", "CONJ", "MUN", "ARE_LOC", "DESCR", "GEOMETRY", "NR_EQUIPAMENTO")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT "COD_ID",
"DIST",
"PAC_1",
"PAC_2",
"FAS_CON",
"TIP_UNID",
"P_N_OPE",
"POS",
"CTMT",
"UNI_TR_S",
"SUB",
"CONJ",
"MUN",
"ARE_LOC",
"DESCR",
"GEOMETRY",
NR_EQUIPAMENTO
FROM MV_GENESIS_UNSEMT_RELIG
UNION
ALL
SELECT "COD_ID",
"DIST",
"PAC_1",
"PAC_2",
"FAS_CON",
"TIP_UNID",
"P_N_OPE",
"POS",
"CTMT",
"UNI_TR_S",
"SUB",
"CONJ",
"MUN",
"ARE_LOC",
"DESCR",
"GEOMETRY",
NR_EQUIPAMENTO
FROM MV_GENESIS_UNSEMT_SECLZ
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNSEMT_2" ("COD_ID", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_UNID", "P_N_OPE", "POS", "CTMT", "SUB", "CONJ", "MUN", "ARE_LOC", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT "COD_ID",
"DIST",
"PAC_1",
"PAC_2",
"FAS_CON",
"TIP_UNID",
"P_N_OPE",
"POS",
"CTMT",
"SUB",
"CONJ",
"MUN",
"ARE_LOC",
"DESCR",
"GEOMETRY"
FROM MV_GENESIS_UNSEMT_SECND
UNION
ALL
SELECT "COD_ID",
"DIST",
"PAC_1",
"PAC_2",
"FAS_CON",
"TIP_UNID",
"P_N_OPE",
"POS",
"CTMT",
"SUB",
"CONJ",
"MUN",
"ARE_LOC",
"DESCR",
"GEOMETRY"
FROM MV_GENESIS_UNSEMT_FUSVL
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNSEMT_FUSVL" ("COD_ID", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_UNID", "P_N_OPE", "POS", "CTMT", "UNI_TR_S", "SUB", "CONJ", "MUN", "ARE_LOC", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT PRI.ID COD_ID,
       '5697' DIST,
       RDE.NR_PTO_ELET_INICIO PAC_1,
       RDE.NR_PTO_ELET_FIM PAC_2,
       DECODE(PRI.ID_FASE_LIGADA_FU,   1, 'A',
                                       2, 'B',
                                       3, 'C',
                                       4, 'AB',
                                       5, 'CA',
                                       6, 'BC',
                                       7, 'ABC') FAS_CON,
       DECODE(PRI.ID_TIPO_CHAVE_FU, 1, 22, 2, 24, 3, 27, -1) TIP_UNID,
       DECODE(PRI.ID_EST_BASICO_FU, 1, 'A', 2, 'F', '-1') P_N_OPE,
       DECODE(PRI.ID_PRPR_FU, 1, 'PD', 2, 'O', '-1') POS,
       ALI.CD_ALIMENTADOR CTMT,
       CAST(NULL AS VARCHAR2(20)) UNI_TR_S,
       SUB.SG_SUBESTACAO SUB,
       CONJ.NR_CONJUNTO_ANEEL CONJ,
       MUN.NR_MUN_ANEEL MUN,
       DECODE(PRI.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', '-1') ARE_LOC,
       CAST(SAP.NR_LOCALINST_SAP AS VARCHAR2(255)) DESCR,
       --'0' NR_EQUIPAMENTO,
       PRI.GEOMETRY
FROM VS_PRI_CHAVE_FUSVL_RD PRI
     LEFT JOIN RDE_CONEC_CPR RDE
          ON RDE.FEATURE_ID = PRI.ID
     LEFT JOIN VS_PRI_ALIMENTADOR ALI
          ON ALI.PRI_ALIMENTADOR_ID = PRI.PRI_ALIMENTADOR_ID
     LEFT JOIN VS_PRI_SUBESTACAO SUB
          ON ALI.PRI_SUBESTACAO_ID = SUB.PRI_SUBESTACAO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON CONJ.PRI_CONJUNTO_CNS_ID = PRI.PRI_CONJUNTO_CNS_ID
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON MUN.PRI_MUNICIPIO_ID = PRI.PRI_MUNICIPIO_ID
     LEFT JOIN TAB_SAP_CHAVE_FUSIVEL SAP
          ON SAP.NR_LOCZ_EQPTO_RD = PRI.NR_LOCZ_EQPTO_RD
             AND SAP.NR_REGIONAL = PRI.AREA_REGL_RSPDD_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNSEMT_RELIG" ("COD_ID", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_UNID", "P_N_OPE", "POS", "CTMT", "UNI_TR_S", "SUB", "CONJ", "MUN", "ARE_LOC", "DESCR", "NR_EQUIPAMENTO", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT PRI.ID COD_ID,
       '5697' DIST,
       RDE.NR_PTO_ELET_INICIO PAC_1,
       RDE.NR_PTO_ELET_FIM PAC_2,
       DECODE(PRI.ID_FASE_LIGADA_RL,   1, 'A',
                                       2, 'B',
                                       3, 'C',
                                       4, 'AB',
                                       5, 'CA',
                                       6, 'BC',
                                       7, 'ABC') FAS_CON,
       32 TIP_UNID,
       DECODE(PRI.ID_EST_BASICO_RL, 1, 'A', 2, 'F', '-1') P_N_OPE,
       'PD' POS,
       ALI.CD_ALIMENTADOR CTMT,
       CAST(NULL AS VARCHAR2(20)) UNI_TR_S,
       SUB.SG_SUBESTACAO SUB,
       CONJ.NR_CONJUNTO_ANEEL CONJ,
       MUN.NR_MUN_ANEEL MUN,
       DECODE(PRI.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', '-1') ARE_LOC,
       CAST(SAP.NR_LOCALINST_SAP AS VARCHAR2(255)) DESCR,
       CAST(SAP.NR_EQUIPAMENTO AS VARCHAR2(20)) NR_EQUIPAMENTO,
       PRI.GEOMETRY
FROM VS_PRI_RELIGADOR PRI
     LEFT JOIN RDE_CONEC_CPR RDE
          ON RDE.FEATURE_ID = PRI.ID
     LEFT JOIN VS_PRI_ALIMENTADOR ALI
          ON ALI.PRI_ALIMENTADOR_ID = PRI.PRI_ALIMENTADOR_ID
     LEFT JOIN VS_PRI_SUBESTACAO SUB
          ON ALI.PRI_SUBESTACAO_ID = SUB.PRI_SUBESTACAO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON CONJ.PRI_CONJUNTO_CNS_ID = PRI.PRI_CONJUNTO_CNS_ID
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON MUN.PRI_MUNICIPIO_ID = PRI.PRI_MUNICIPIO_ID
     LEFT JOIN TAB_SAP_RELIGADOR SAP
          ON PRI.NR_LOCZ_EQPTO_RD = SAP.NR_LOCZ_EQPTO_RD
             AND PRI.AREA_REGL_RSPDD_ID = SAP.NR_REGIONAL
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNSEMT_SECLZ" ("COD_ID", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_UNID", "P_N_OPE", "POS", "CTMT", "UNI_TR_S", "SUB", "CONJ", "MUN", "ARE_LOC", "DESCR", "NR_EQUIPAMENTO", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT PRI.ID COD_ID,
       '5697' DIST,
       RDE.NR_PTO_ELET_INICIO PAC_1,
       RDE.NR_PTO_ELET_FIM PAC_2,
       DECODE(PRI.ID_FASE_LIGADA_SL,   1, 'A',
                                       2, 'B',
                                       3, 'C',
                                       4, 'AB',
                                       5, 'CA',
                                       6, 'BC',
                                       7, 'ABC') FAS_CON,
       35 TIP_UNID,
       DECODE(PRI.ID_EST_BASICO_SL, 1, 'A', 2, 'F', '-1') P_N_OPE,
       'PD' POS,
       ALI.CD_ALIMENTADOR CTMT,
       CAST(NULL AS VARCHAR2(20)) UNI_TR_S,
       SUB.SG_SUBESTACAO SUB,
       CONJ.NR_CONJUNTO_ANEEL CONJ,
       MUN.NR_MUN_ANEEL MUN,
       DECODE(PRI.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', '-1') ARE_LOC,
       CAST(SAP.NR_LOCALINST_SAP AS VARCHAR2(255)) DESCR,
       CAST(SAP.NR_EQUIPAMENTO AS VARCHAR2(20)) NR_EQUIPAMENTO,
       PRI.GEOMETRY
FROM VS_PRI_SECLZ PRI
     LEFT JOIN RDE_CONEC_CPR RDE
          ON RDE.FEATURE_ID = PRI.ID
     LEFT JOIN VS_PRI_ALIMENTADOR ALI
          ON ALI.PRI_ALIMENTADOR_ID = PRI.PRI_ALIMENTADOR_ID
     LEFT JOIN VS_PRI_SUBESTACAO SUB
          ON ALI.PRI_SUBESTACAO_ID = SUB.PRI_SUBESTACAO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON CONJ.PRI_CONJUNTO_CNS_ID = PRI.PRI_CONJUNTO_CNS_ID
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON MUN.PRI_MUNICIPIO_ID = PRI.PRI_MUNICIPIO_ID
     LEFT JOIN TAB_SAP_SECLZ SAP
          ON PRI.NR_LOCZ_EQPTO_RD = SAP.NR_LOCZ_EQPTO_RD
             AND PRI.AREA_REGL_RSPDD_ID = SAP.NR_REGIONAL
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_UNSEMT_SECND" ("COD_ID", "DIST", "PAC_1", "PAC_2", "FAS_CON", "TIP_UNID", "P_N_OPE", "POS", "CTMT", "SUB", "CONJ", "MUN", "ARE_LOC", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT PRI.ID COD_ID,
       '5697' DIST,
       RDE.NR_PTO_ELET_INICIO PAC_1,
       RDE.NR_PTO_ELET_FIM PAC_2,
       DECODE(PRI.ID_FASE_LIGADA_CH,   1, 'A',
                                       2, 'B',
                                       3, 'C',
                                       4, 'AB',
                                       5, 'CA',
                                       6, 'BC',
                                       7, 'ABC') FAS_CON,
       DECODE(PRI.ID_TIPO_CHAVE_CH, 1, 21, 2, 19, 3, 20, 4, 20, 5, 26, 6, 17, 7, 16,  -1) TIP_UNID,
       DECODE(PRI.ID_EST_BASICO_CH, 1, 'A', 2, 'F', '-1') P_N_OPE,
       DECODE(PRI.ID_PRPR_CH, 1, 'PD', 2, 'O', '-1') POS,
       ALI.CD_ALIMENTADOR CTMT,
       --NULL UNI_TR_S,
       SUB.SG_SUBESTACAO SUB,
       CAST(CONJ.NR_CONJUNTO_ANEEL AS VARCHAR2(20)) CONJ,
       MUN.NR_MUN_ANEEL MUN,
       DECODE(PRI.ID_AREA_OBJETO, 'U', 'UB', 'R', 'NU', '-1') ARE_LOC,
       SAP.NR_LOCALINST_SAP DESCR,
       --'0' NR_EQUIPAMENTO,
       PRI.GEOMETRY
FROM VS_PRI_CHAVE_SECND_RD PRI
     LEFT JOIN RDE_CONEC_CPR RDE
          ON RDE.FEATURE_ID = PRI.ID
     LEFT JOIN VS_PRI_ALIMENTADOR ALI
          ON ALI.PRI_ALIMENTADOR_ID = PRI.PRI_ALIMENTADOR_ID
     LEFT JOIN VS_PRI_SUBESTACAO SUB
          ON ALI.PRI_SUBESTACAO_ID = SUB.PRI_SUBESTACAO_ID
     LEFT JOIN VA_CONJUNTO_ANEEL CONJ
          ON CONJ.PRI_CONJUNTO_CNS_ID = PRI.PRI_CONJUNTO_CNS_ID
     LEFT JOIN VA_MUNICIPIO_ANEEL MUN
          ON MUN.PRI_MUNICIPIO_ID = PRI.PRI_MUNICIPIO_ID
     LEFT JOIN TAB_SAP_CHAVE_SECND SAP
          ON SAP.NR_LOCZ_EQPTO_RD = PRI.NR_LOCZ_EQPTO_RD
             AND SAP.NR_REGIONAL = PRI.AREA_REGL_RSPDD_ID
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_VA_ALI_PTO_ELET" ("ID", "CD_ALIMENTADOR", "NR_LOCALINST_SAP", "NR_PTO_ELET_FIM", "PAI_ALIMENTADOR")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS select ali.id,
       --ali.PRI_ALIMENTADOR_ID,
       ali.CD_ALIMENTADOR,
       sap.nr_localinst_sap,
       rde.nr_pto_elet_fim,
       'SE-' || con.pac1_fid pai_alimentador
       --(select * from rde_conec_cpr where )
from vs_pri_alimentador ali
     left join rde_conec_cpr rde
          on ali.id = rde.feature_id
     left join tab_sap_alimentador sap
          on sap.cd_alimentador = ali.CD_ALIMENTADOR
     left join tab_node_sub node
          on node.nome = ali.CD_ALIMENTADOR
     left join tab_bdgd_sub_conn con
          on con.pac2_fid = node.objectid
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_VA_CONEC_MT_BT" ("ID", "NR_PTO_ELET_INICIO", "NR_PTO_ELET_FIM")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM VA_CONEC_MT_BT
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_VA_CONJUNTO_ANEEL" ("PRI_CONJUNTO_CNS_ID", "CD_CONJUNTO_CNS", "NR_CONJUNTO_ANEEL", "NM_CONJUNTO_CNS", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM VA_CONJUNTO_ANEEL
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_VA_MUNICIPIO_ANEEL" ("PRI_MUNICIPIO_ID", "MUNICIPIO_ID", "NM_MUNICIPIO", "NR_MUN_ANEEL")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM VA_MUNICIPIO_ANEEL
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_VS_PRI_ALIMENTADOR" ("ID", "FEATURE_TYPE", "SHOW_SUBFEATURE", "SCALE_FACTOR", "TEXT", "GEOMETRY", "ROTATION", "ANCHOR_X", "ANCHOR_Y", "INVISIBLE", "PRI_ALIMENTADOR_ID", "COORD_X", "COORD_Y", "AREA", "LENGTH", "ID_AREA_OBJETO", "PRI_MUNICIPIO_ID", "AREA_REGL_RSPDD_ID", "PRI_CONJUNTO_CNS_ID", "PRI_SUBESTACAO_ID", "OLD_FEAT_NUM", "OLD_FEAT_CODE", "CD_ALIMENTADOR", "NM_ALIMENTADOR", "OLD_SG_UND_ASSOC_BBSE", "PRI_BARRAMENTO_BT_ID", "ID_TN_NOMINAL_AL", "ID_CARGA_PRMTE_AL", "NR_LOCALINST_GEN", "OLD_NR_PTO_ELETRICO", "NR_REGIONAL_GEO", "ID_SUB", "NR_LOCALINST_SAP", "PLAN_F_ID")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM VS_PRI_ALIMENTADOR
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_VS_PRI_SUBESTACAO" ("ID", "FEATURE_TYPE", "SHOW_SUBFEATURE", "SCALE_FACTOR", "TEXT", "GEOMETRY", "ROTATION", "ANCHOR_X", "ANCHOR_Y", "INVISIBLE", "PRI_SUBESTACAO_ID", "COORD_X", "COORD_Y", "AREA", "LENGTH", "OLD_FEAT_NUM", "OLD_FEAT_CODE", "NR_SUBESTACAO", "NM_SUBESTACAO", "SG_SUBESTACAO", "AREA_REGL_RSPDD_ID", "ID_CATEGORIA_SE", "CD_MUNICIPIO", "ID_MTRMT_SE", "NM_PROPRIETARIO", "NR_LOCALINST_GEN", "ID_AREA_OBJETO", "PRI_MUNICIPIO_ID", "PRI_CONJUNTO_CNS_ID", "NR_REGIONAL_GEO", "CENTROID_GEO")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "CENTROID_GEO"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "CENTROID_GEO"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT a.*, sdo_geom.sdo_centroid(a.geometry) centroid_geo FROM VS_PRI_SUBESTACAO a
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_V_BDGD_CONJ" ("ID", "DIST", "NOM", "SIST_INTE", "SIST_SUBT", "DESCR", "GEOMETRY")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
 VARRAY "GEOMETRY"."SDO_ELEM_INFO" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 VARRAY "GEOMETRY"."SDO_ORDINATES" STORE AS SECUREFILE LOB 
  ( TABLESPACE "TS_STAGING" ENABLE STORAGE IN ROW CHUNK 8192
  CACHE  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM V_BDGD_CONJ
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_V_BDGD_CTAT" ("COD_ID", "NOM", "TEN_NOM", "DIST")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM V_BDGD_CTAT
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_V_BDGD_EQCR" ("COD_ID", "PAC_1", "PAC_2", "SUB", "DESCR", "TI", "FID")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM V_BDGD_EQCR
----------------------------------------------

  CREATE MATERIALIZED VIEW "BDGD_STAGING"."MV_GENESIS_V_BDGD_EQME" ("NR_CONTA_CNS", "PAC")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TS_STAGING" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND NEXT null
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE ON QUERY COMPUTATION DISABLE QUERY REWRITE
  AS SELECT * FROM V_BDGD_EQME
----------------------------------------------

